let GAME_CONFIG={winsNeededForLevelUp:3,baseRange:20,rangeIncrement:10,baseAttempts:6,baseHints:2,pointsPerLevel:50},puzzleState={targetNumber:0,attemptsLeft:GAME_CONFIG.baseAttempts,maxAttempts:GAME_CONFIG.baseAttempts,minRange:1,maxRange:GAME_CONFIG.baseRange,guesses:[],hintsUsed:0,maxHints:GAME_CONFIG.baseHints,level:1,winsThisLevel:0,streak:0,maxStreak:0,points:0,timerStart:null,timerEnd:null,currentChallenge:null,gameStarted:!1,unlockedFeatures:{doublePoints:!1,extraHints:!1,timeBonus:!1}},CHALLENGES=[{name:"Blind Mode",description:"No feedback after guesses!",modifier:e=>{e.blindMode=!0}},{name:"Speed Run",description:"Solve in under 30 seconds for bonus!",modifier:e=>{e.speedRun=!0}},{name:"Precision",description:"Number range doubled!",modifier:e=>{e.maxRange*=2}}];function trackEvent(e,t,a,n){"undefined"!=typeof gtag&&gtag("event",e,{event_category:t,event_label:a,value:n})}function startNewPuzzle(){var e=GAME_CONFIG.baseRange+(puzzleState.level-1)*GAME_CONFIG.rangeIncrement;puzzleState.minRange=1,puzzleState.maxRange=e,puzzleState.targetNumber=Math.floor(Math.random()*e)+1,puzzleState.attemptsLeft=GAME_CONFIG.baseAttempts+Math.floor(puzzleState.level/3),puzzleState.maxAttempts=puzzleState.attemptsLeft,puzzleState.guesses=[],puzzleState.hintsUsed=0,puzzleState.maxHints=puzzleState.unlockedFeatures.extraHints?3:GAME_CONFIG.baseHints,puzzleState.timerStart=null,puzzleState.timerEnd=null,puzzleState.gameStarted=!1,puzzleState.blindMode=!1,puzzleState.speedRun=!1,(puzzleState.level%3==0?(puzzleState.currentChallenge=CHALLENGES[Math.floor(Math.random()*CHALLENGES.length)],puzzleState.currentChallenge.modifier(puzzleState),showChallengeBanner):(puzzleState.currentChallenge=null,hideChallengeBanner))(),updatePuzzleUI();let t=document.getElementById("number-guess");e=document.getElementById("puzzle-feedback");t&&(t.value="",t.min=puzzleState.minRange,t.max=puzzleState.maxRange,t.placeholder=`Guess (${puzzleState.minRange}-${puzzleState.maxRange})`),e&&(e.textContent="",e.className="puzzle-feedback"),setTimeout(()=>{t.focus()},100)}function showChallengeBanner(){var e=document.getElementById("challenge-banner"),t=document.getElementById("challenge-description");e&&t&&puzzleState.currentChallenge&&(e.classList.remove("hidden"),t.textContent=puzzleState.currentChallenge.description)}function hideChallengeBanner(){var e=document.getElementById("challenge-banner");e&&e.classList.add("hidden")}function calculateScore(){if(!puzzleState.timerStart)return 0;var e=(puzzleState.timerEnd-puzzleState.timerStart)/1e3,t=puzzleState.speedRun?30:60;let a=GAME_CONFIG.pointsPerLevel*puzzleState.level;var n=20*puzzleState.streak;let l=5*Math.max(0,t-e);var t=30*puzzleState.hintsUsed,e=puzzleState.currentChallenge?200:0,u=Math.floor(puzzleState.maxRange/10);return puzzleState.unlockedFeatures.doublePoints&&(a*=2),puzzleState.unlockedFeatures.timeBonus&&(l*=1.5),Math.floor(a+n+l+e+u-t)}function handleGuessSubmit(){var e=document.getElementById("number-guess");let t=document.getElementById("puzzle-feedback");var a,n,l=parseInt(e.value);!puzzleState.gameStarted&&!isNaN(l)&&l>=puzzleState.minRange&&l<=puzzleState.maxRange&&(puzzleState.timerStart=Date.now(),puzzleState.gameStarted=!0),isNaN(l)?t&&(t.textContent="Please enter a valid number",t.className="puzzle-feedback feedback-wrong"):l<puzzleState.minRange||l>puzzleState.maxRange?t&&(t.textContent=`Please enter between ${puzzleState.minRange}-`+puzzleState.maxRange,t.className="puzzle-feedback feedback-wrong"):(puzzleState.guesses.push(l),puzzleState.attemptsLeft--,l===puzzleState.targetNumber?(puzzleState.timerEnd=Date.now(),puzzleState.streak++,puzzleState.maxStreak=Math.max(puzzleState.streak,puzzleState.maxStreak),puzzleState.winsThisLevel++,n=calculateScore(),puzzleState.points+=n,a=puzzleState.timerStart?(puzzleState.timerEnd-puzzleState.timerStart)/1e3:0,t&&(t.innerHTML=`
                <div class="feedback-message">
                    <strong>ðŸŽ‰ Correct! (Level ${puzzleState.level})</strong><br>
                    Time: ${a.toFixed(1)}s | Streak: ${puzzleState.streak}<br>
                    Wins at this level: ${puzzleState.winsThisLevel}/${GAME_CONFIG.winsNeededForLevelUp}<br>
                    Points: +${n}
                </div>
            `,t.className="puzzle-feedback feedback-correct"),(a=document.getElementById("submit-guess"))&&(a.disabled=!0),trackEvent("puzzle_solved","number_puzzle",puzzleState.maxAttempts-puzzleState.attemptsLeft),checkForUnlocks(),puzzleState.winsThisLevel>=GAME_CONFIG.winsNeededForLevelUp?(puzzleState.level++,puzzleState.winsThisLevel=0,setTimeout(()=>{t.innerHTML+=`<br><br>Advancing to Level ${puzzleState.level} (1-${GAME_CONFIG.baseRange+(puzzleState.level-1)*GAME_CONFIG.rangeIncrement})!`,setTimeout(startNewPuzzle,3e3)},1500)):setTimeout(startNewPuzzle,3e3)):puzzleState.attemptsLeft<=0?(puzzleState.timerEnd=Date.now(),puzzleState.streak=0,puzzleState.winsThisLevel=0,t&&(t.innerHTML=`
                <div class="feedback-message">
                    <strong>Game Over!</strong><br>
                    The number was ${puzzleState.targetNumber}<br>
                    Level: ${puzzleState.level} (1-${puzzleState.maxRange})
                </div>
            `,t.className="puzzle-feedback feedback-wrong"),(n=document.getElementById("submit-guess"))&&(n.disabled=!0),trackEvent("puzzle_failed","number_puzzle",puzzleState.targetNumber),setTimeout(startNewPuzzle,3e3)):puzzleState.blindMode?t&&(t.textContent="Guess submitted (Blind Mode)",t.className="puzzle-feedback"):l<puzzleState.targetNumber?(puzzleState.minRange=l+1,t&&(t.textContent="Too low! Try a higher number.",t.className="puzzle-feedback feedback-low")):(puzzleState.maxRange=l-1,t&&(t.textContent="Too high! Try a lower number.",t.className="puzzle-feedback feedback-high")),updatePuzzleUI(),e&&(e.value=""))}function checkForUnlocks(){var e;3<=puzzleState.level&&!puzzleState.unlockedFeatures.extraHints&&(puzzleState.unlockedFeatures.extraHints=!0,(e=document.getElementById("puzzle-feedback"))&&(e.innerHTML+="<br><br>âœ¨ Unlocked: Extra Hints! (3 per game now)"),trackEvent("feature_unlock","game","extra_hints")),5<=puzzleState.level&&!puzzleState.unlockedFeatures.doublePoints&&(puzzleState.unlockedFeatures.doublePoints=!0,(e=document.getElementById("puzzle-feedback"))&&(e.innerHTML+="<br><br>âœ¨ Unlocked: Double Points!"),trackEvent("feature_unlock","game","double_points")),3<=puzzleState.streak&&!puzzleState.unlockedFeatures.timeBonus&&(puzzleState.unlockedFeatures.timeBonus=!0,(e=document.getElementById("puzzle-feedback"))&&(e.innerHTML+="<br><br>âœ¨ Unlocked: Time Bonus! (50% more points for fast solves)"),trackEvent("feature_unlock","game","time_bonus"))}function giveHint(){if(puzzleState.hintsUsed>=puzzleState.maxHints){let e=document.getElementById("puzzle-feedback");void(e&&(e.textContent="You have used all your hints!",e.className="puzzle-feedback feedback-wrong"))}else{puzzleState.hintsUsed++;var t=Math.floor((puzzleState.maxRange-puzzleState.minRange)/4),t=`The number is between ${Math.max(puzzleState.minRange,puzzleState.targetNumber-t)} 
                 and `+Math.min(puzzleState.maxRange,puzzleState.targetNumber+t);let e=document.getElementById("puzzle-feedback");e&&(e.textContent=t,e.className="puzzle-feedback"),updatePuzzleUI(),trackEvent("puzzle_hint","number_puzzle",puzzleState.hintsUsed)}}function updatePuzzleUI(){var e=document.getElementById("puzzle-attempts"),t=document.getElementById("puzzle-hint");let l=document.getElementById("guess-history");var a=document.getElementById("puzzle-hint-btn"),n=document.getElementById("current-level"),u=document.getElementById("current-streak"),z=document.getElementById("current-points"),r=document.getElementById("current-time"),s=document.getElementById("progress-fill");e&&(e.textContent=`Attempts left: ${puzzleState.attemptsLeft}/`+puzzleState.maxAttempts),t&&(t.textContent=`Level ${puzzleState.level}: Between ${puzzleState.minRange}-`+puzzleState.maxRange),l&&(l.innerHTML="",puzzleState.guesses.forEach(e=>{var t=e<puzzleState.targetNumber?"â†‘":e>puzzleState.targetNumber?"â†“":"âœ“",a=e===puzzleState.targetNumber?"correct":e<puzzleState.targetNumber?"low":"high",n=document.createElement("div");n.className="guess-entry "+a,n.innerHTML=`
                <span>${e}</span>
                <span>${t}</span>
            `,l.appendChild(n)})),a&&(a.textContent=`Get Hint (${puzzleState.maxHints-puzzleState.hintsUsed} left)`,a.disabled=puzzleState.hintsUsed>=puzzleState.maxHints),n&&(n.textContent=puzzleState.level),u&&(u.textContent=puzzleState.streak),z&&(z.textContent=puzzleState.points),r&&(puzzleState.timerStart?(e=puzzleState.timerEnd?(puzzleState.timerEnd-puzzleState.timerStart)/1e3:(Date.now()-puzzleState.timerStart)/1e3,r.textContent=e.toFixed(1)):r.textContent="0.0"),s&&(t=(puzzleState.maxAttempts-puzzleState.attemptsLeft)/puzzleState.maxAttempts*100,s.style.width=t+"%")}function setupPuzzleEvents(){var e=document.getElementById("submit-guess"),t=document.getElementById("new-puzzle"),a=document.getElementById("puzzle-hint-btn"),n=document.getElementById("number-guess");e&&e.addEventListener("click",handleGuessSubmit),t&&t.addEventListener("click",startNewPuzzle),a&&a.addEventListener("click",giveHint),n&&n.addEventListener("keypress",e=>{"Enter"===e.key&&handleGuessSubmit()})}function initPuzzle(){setupPuzzleEvents(),startNewPuzzle(),setInterval(()=>{var e,t=document.getElementById("current-time");t&&puzzleState.timerStart&&!puzzleState.timerEnd&&(e=(Date.now()-puzzleState.timerStart)/1e3,t.textContent=e.toFixed(1))},100)}export{initPuzzle};
