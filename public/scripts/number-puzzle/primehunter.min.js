function initPuzzle(){let l={level:1,score:0,timeLeft:60,primesInGrid:0,primesCollected:0,currentNumbers:[],gameActive:!1,isMuted:JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,timerInterval:null},r={select:new Audio("/audio/click.mp3"),correct:new Audio("/audio/correct.mp3"),win:new Audio("/audio/win.mp3"),error:new Audio("/audio/wrong.mp3")},o={hunterGrid:document.getElementById("hunter-grid"),hunterFeedback:document.getElementById("hunter-feedback"),hunterHint:document.getElementById("hunter-hint"),hunterNew:document.getElementById("hunter-new"),hunterLevel:document.getElementById("hunter-level"),hunterScore:document.getElementById("hunter-score"),hunterTime:document.getElementById("hunter-time"),primesFound:document.getElementById("primes-found"),primesTotal:document.getElementById("primes-total"),progressFill:document.getElementById("progress-fill")};function a(t){l.isMuted?console.log(`Sound ${t} skipped: muted`):r[t]&&(r[t].currentTime=0,r[t].play().catch(e=>console.error(`Error playing ${t} sound:`,e)))}function t(){Object.keys(r).forEach(e=>{e=e,r[e]&&(r[e].pause(),r[e].currentTime=0)})}function n(){clearInterval(l.timerInterval),l.level=1,l.score=0,l.timeLeft=60,l.primesCollected=0,l.isMuted=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,u(),c(),s(),l.gameActive=!0,"undefined"!=typeof gtag&&gtag("event","primehunter_started",{event_category:"primehunter",event_label:1,value:void 0}),l.isMuted&&t();var e=document.querySelector("#mute-btn .material-icons");e&&(e.textContent=l.isMuted?"volume_off":"volume_up"),a("select")}function c(){o.hunterGrid.innerHTML="",l.currentNumbers=[],l.primesInGrid=0;var t=l.level<=3?4:l.level<=6?5:6,r=l.level<=2?30:l.level<=4?50:l.level<=6?75:100;for(let e=0;e<t*t;e++){var i=Math.floor(Math.random()*r)+1;l.currentNumbers.push(i);let n=document.createElement("div");n.className="hunter-cell",n.textContent=i,n.dataset.number=i,n.dataset.isPrime=(t=>{if(t<=1)return!1;if(!(t<=3)){if(t%2==0||t%3==0)return!1;for(let e=5;e*e<=t;e+=6)if(t%e==0||t%(e+2)==0)return!1}return!0})(i),"true"===n.dataset.isPrime&&l.primesInGrid++,n.addEventListener("click",()=>{var e,t=n;if(l.gameActive&&(parseInt(t.dataset.number),e="true"===t.dataset.isPrime,a("select"),!t.classList.contains("selected")))if(t.classList.add("selected"),e){if(t.classList.add("correct"),l.primesCollected++,l.score+=5*l.level,u(),d(),a("correct"),l.primesCollected===l.primesInGrid){l.gameActive=!1,clearInterval(l.timerInterval),o.hunterFeedback.textContent=`Level Complete! +${20*l.level} bonus points!`,o.hunterFeedback.className="hunter-feedback correct",l.score+=20*l.level,l.level++,u(),a("win");var r={particleCount:250,spread:80};if(console.log("Triggering confetti"),"undefined"==typeof confetti)console.error("Confetti library not loaded");else{let e={particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]};confetti({...e,...r}),.5<Math.random()&&setTimeout(()=>{confetti({...e,...r,angle:180*Math.random()-90,origin:{x:Math.random(),y:.6}})},300)}setTimeout(()=>{l.timeLeft=60,l.primesCollected=0,l.gameActive=!0,c(),s()},2e3)}}else t.classList.add("wrong"),l.timeLeft=Math.max(5,l.timeLeft-5),u(),a("error")}),o.hunterGrid.appendChild(n)}o.primesTotal.textContent=l.primesInGrid,o.primesFound.textContent=l.primesCollected,d(),o.hunterGrid.style.gridTemplateColumns=`repeat(${t}, 1fr)`}function s(){console.log("Starting timer"),clearInterval(l.timerInterval),l.timerInterval=setInterval(()=>{console.log("Timer tick: "+l.timeLeft),l.timeLeft--,u(),l.timeLeft<=10&&o.hunterTime.classList.add("time-critical"),l.timeLeft<=0&&(console.log("Timer expired"),clearInterval(l.timerInterval),l.timerInterval=null,l.gameActive=!1,o.hunterFeedback.textContent="Game Over! Final Score: "+l.score,o.hunterFeedback.className="hunter-feedback wrong",a("error"),document.querySelectorAll(".hunter-cell").forEach(e=>{"true"!==e.dataset.isPrime||e.classList.contains("correct")||e.classList.add("missed")}))},1e3)}function i(){if(l.gameActive){a("select");var t=Array.from(document.querySelectorAll(".hunter-cell")).filter(e=>"true"===e.dataset.isPrime&&!e.classList.contains("correct"));if(0<t.length){let e=t[Math.floor(Math.random()*t.length)];e.classList.add("hint"),setTimeout(()=>{e.classList.remove("hint")},1e3)}else o.hunterFeedback.textContent="No primes left to find!",o.hunterFeedback.className="hunter-feedback info"}}function u(){o.hunterLevel.textContent="Level: "+l.level,o.hunterScore.textContent="Score: "+l.score,o.hunterTime.textContent=`Time: ${l.timeLeft}s`,o.primesFound.textContent=l.primesCollected}function d(){var e=0<l.primesInGrid?l.primesCollected/l.primesInGrid*100:0;o.progressFill.style.width=e+"%"}n();{o.hunterHint.addEventListener("click",i),o.hunterNew.addEventListener("click",n);var m=document.getElementById("mute-btn");let e=document.querySelector("#mute-btn .material-icons");m&&m.addEventListener("click",()=>{l.isMuted=!l.isMuted,localStorage.setItem("triviaMasterMuteState",l.isMuted),e&&(e.textContent=l.isMuted?"volume_off":"volume_up"),l.isMuted&&t(),a("select")})}}export{initPuzzle};
