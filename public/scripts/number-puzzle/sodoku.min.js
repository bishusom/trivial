let SUDOKU_CONFIG={difficulties:{easy:{name:"Easy",emptyCells:40},medium:{name:"Medium",emptyCells:50},hard:{name:"Hard",emptyCells:60}},baseHints:3,timeLimit:600},gameState={board:[],solution:[],difficulty:"medium",emptyCells:0,hintsUsed:0,maxHints:SUDOKU_CONFIG.baseHints,selectedCell:null,startTime:null,timerInterval:null,timeElapsed:0,isMuted:JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,stats:{gamesPlayed:0,gamesWon:0,bestTime:1/0}},audioElements={select:new Audio("/audio/click.mp3"),correct:new Audio("/audio/correct.mp3"),wrong:new Audio("/audio/wrong.mp3"),win:new Audio("/audio/win.mp3")};function playSound(t){gameState.isMuted||audioElements[t]&&(audioElements[t].currentTime=0,audioElements[t].play().catch(e=>console.error(`Error playing ${t} sound:`,e)))}function initBoard(){gameState.board=Array(9).fill().map(()=>Array(9).fill(0)),gameState.solution=Array(9).fill().map(()=>Array(9).fill(0)),gameState.selectedCell=null,gameState.hintsUsed=0,gameState.timeElapsed=0,clearInterval(gameState.timerInterval),generateSolution(0,0),createPlayableBoard(),gameState.startTime=Date.now(),gameState.timerInterval=setInterval(updateTimer,1e3),updateUI()}function generateSolution(e,t){if(9===e)return!0;var a=8===t?e+1:e,l=8===t?0:t+1;if(0!==gameState.solution[e][t])return generateSolution(a,l);var o,n=[1,2,3,4,5,6,7,8,9];shuffleArray(n);for(o of n)if(isValidPlacement(gameState.solution,e,t,o)){if(gameState.solution[e][t]=o,generateSolution(a,l))return!0;gameState.solution[e][t]=0}return!1}function createPlayableBoard(){for(let t=0;t<9;t++)for(let e=0;e<9;e++)gameState.board[t][e]=gameState.solution[t][e];var e=SUDOKU_CONFIG.difficulties[gameState.difficulty].emptyCells;gameState.emptyCells=e;let t=0;for(;t<e;){var a,l=Math.floor(9*Math.random()),o=Math.floor(9*Math.random());0!==gameState.board[l][o]&&(a=gameState.board[l][o],gameState.board[l][o]=0,1===countSolutions(JSON.parse(JSON.stringify(gameState.board)))?t++:gameState.board[l][o]=a)}}function countSolutions(t){let a=0;let l=0,o=0,e=!1;for(l=0;l<9;l++){for(o=0;o<9;o++)if(0===t[l][o]){e=!0;break}if(e)break}if(!e)return 1;for(let e=1;e<=9;e++)if(isValidPlacement(t,l,o,e)){if(t[l][o]=e,1<(a+=countSolutions(t)))return a;t[l][o]=0}return a}function isValidPlacement(a,t,l,o){for(let e=0;e<9;e++)if(a[t][e]===o)return!1;for(let e=0;e<9;e++)if(a[e][l]===o)return!1;var n=3*Math.floor(t/3),r=3*Math.floor(l/3);for(let t=0;t<3;t++)for(let e=0;e<3;e++)if(a[n+t][r+e]===o)return!1;return!0}function shuffleArray(t){for(let e=t.length-1;0<e;e--){var a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}return t}function updateTimer(){gameState.timeElapsed=Math.floor((Date.now()-gameState.startTime)/1e3);var e=Math.floor(gameState.timeElapsed/60),t=gameState.timeElapsed%60,a=document.getElementById("puzzle-time");a&&(a.textContent=`Time: ${e}:`+t.toString().padStart(2,"0"))}function updateUI(){var e=document.getElementById("sudoku-grid");if(e){console.log("Updating Sudoku grid..."),e.innerHTML="";for(let t=0;t<9;t++){var a=document.createElement("div");a.className="sudoku-row",console.log("Creating row "+t);for(let e=0;e<9;e++){var l=document.createElement("div");l.className="sudoku-cell",l.dataset.row=t,l.dataset.col=e,console.log(`Creating cell [${t}][${e}]`),0!==gameState.board[t][e]&&(l.textContent=gameState.board[t][e],l.classList.add(gameState.solution[t][e]===gameState.board[t][e]?"fixed":"user-input")),gameState.selectedCell&&gameState.selectedCell.row===t&&gameState.selectedCell.col===e&&l.classList.add("selected"),l.addEventListener("click",()=>selectCell(t,e)),a.appendChild(l)}e.appendChild(a)}}var t=document.getElementById("puzzle-difficulty"),t=(t&&(t.textContent="Difficulty: "+SUDOKU_CONFIG.difficulties[gameState.difficulty].name),document.getElementById("puzzle-hints")),t=(t&&(t.textContent="Hints left: "+(gameState.maxHints-gameState.hintsUsed)),document.getElementById("games-played")),o=document.getElementById("games-won"),n=document.getElementById("best-time");t&&(t.textContent=gameState.stats.gamesPlayed),o&&(o.textContent=gameState.stats.gamesWon),n&&(t=Math.floor(gameState.stats.bestTime/60),o=gameState.stats.bestTime%60,n.textContent=gameState.stats.bestTime===1/0?"0:00":t+":"+o.toString().padStart(2,"0"))}function selectCell(e,t){0!==gameState.board[e][t]&&!gameState.selectedCell||(gameState.selectedCell&&gameState.selectedCell.row===e&&gameState.selectedCell.col===t?gameState.selectedCell=null:gameState.selectedCell={row:e,col:t},updateUI(),playSound("select"))}function fillSelectedCell(e){if(gameState.selectedCell&&0===gameState.board[gameState.selectedCell.row][gameState.selectedCell.col]){var{row:t,col:a}=gameState.selectedCell;if(gameState.board[t][a]=e,gameState.board[t][a]===gameState.solution[t][a])gameState.emptyCells--,0===gameState.emptyCells&&handleWin();else{let e=document.querySelector(`.sudoku-cell[data-row="${t}"][data-col="${a}"]`);e&&(e.classList.add("error"),setTimeout(()=>e.classList.remove("error"),500)),playSound("wrong")}updateUI()}}function handleWin(){clearInterval(gameState.timerInterval),gameState.stats.gamesPlayed++,gameState.stats.gamesWon++,gameState.timeElapsed<gameState.stats.bestTime&&(gameState.stats.bestTime=gameState.timeElapsed);var e,t,a=document.getElementById("puzzle-feedback");a&&(e=Math.floor(gameState.timeElapsed/60),t=gameState.timeElapsed%60,a.innerHTML=`
            <div class="feedback-message">
                <strong>ðŸŽ‰ You solved it!</strong><br>
                Time: ${e}:${t.toString().padStart(2,"0")}<br>
                Difficulty: ${SUDOKU_CONFIG.difficulties[gameState.difficulty].name}
            </div>
        `,a.className="puzzle-feedback feedback-correct"),playSound("win"),showConfetti(),localStorage.setItem("sudokuStats",JSON.stringify(gameState.stats))}function provideHint(){if(gameState.hintsUsed>=gameState.maxHints)(t=document.getElementById("puzzle-feedback"))&&(t.textContent="You have used all your hints!",t.className="puzzle-feedback feedback-wrong",playSound("wrong"));else{var a=[];for(let t=0;t<9;t++)for(let e=0;e<9;e++)0===gameState.board[t][e]&&a.push({row:t,col:e});if(0!==a.length){var t=a[Math.floor(Math.random()*a.length)];gameState.board[t.row][t.col]=gameState.solution[t.row][t.col],gameState.hintsUsed++,gameState.emptyCells--;let e=document.querySelector(`.sudoku-cell[data-row="${t.row}"][data-col="${t.col}"]`);e&&(e.classList.add("highlighted"),setTimeout(()=>e.classList.remove("highlighted"),1e3)),0===gameState.emptyCells&&handleWin(),updateUI(),playSound("correct")}}}function checkBoard(){let l=!1;for(let a=0;a<9;a++)for(let t=0;t<9;t++)if(0!==gameState.board[a][t]&&gameState.board[a][t]!==gameState.solution[a][t]){l=!0;let e=document.querySelector(`.sudoku-cell[data-row="${a}"][data-col="${t}"]`);e&&(e.classList.add("error"),setTimeout(()=>e.classList.remove("error"),1e3))}var e=document.getElementById("puzzle-feedback");e&&(l?(e.textContent="There are errors in your solution.",e.className="puzzle-feedback feedback-wrong",playSound("wrong")):(e.textContent="No errors found so far!",e.className="puzzle-feedback feedback-correct",playSound("correct")))}function showConfetti(e={}){let t={particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]};confetti({...t,...e}),.5<Math.random()&&setTimeout(()=>{confetti({...t,...e,angle:180*Math.random()-90,origin:{x:Math.random(),y:.6}})},300)}function initNumberSelector(){var t=document.getElementById("number-selector");if(t){t.innerHTML="";for(let e=1;e<=9;e++){var a=document.createElement("button");a.className="number-btn",a.textContent=e,a.addEventListener("click",()=>fillSelectedCell(e)),t.appendChild(a)}var e=document.createElement("button");e.className="number-btn clear",e.textContent="Clear",e.addEventListener("click",()=>{var e,t;gameState.selectedCell&&({row:e,col:t}=gameState.selectedCell,0!==gameState.board[e][t])&&gameState.board[e][t]!==gameState.solution[e][t]&&(gameState.board[e][t]=0,gameState.emptyCells++,updateUI(),playSound("select"))}),t.appendChild(e)}}function setupEventListeners(){var e=document.getElementById("hint-btn"),e=(e&&e.addEventListener("click",provideHint),document.getElementById("check-btn")),e=(e&&e.addEventListener("click",checkBoard),document.getElementById("new-game-btn")),e=(e&&e.addEventListener("click",initBoard),document.getElementById("mute-btn"));let t=document.querySelector("#mute-btn .material-icons");e&&e.addEventListener("click",()=>{gameState.isMuted=!gameState.isMuted,localStorage.setItem("triviaMasterMuteState",gameState.isMuted),t&&(t.textContent=gameState.isMuted?"volume_off":"volume_up")}),document.addEventListener("keydown",e=>{var t,a;gameState.selectedCell&&("1"<=(e=e.key)&&e<="9"?fillSelectedCell(parseInt(e)):"Backspace"===e||"Delete"===e||"0"===e?({row:t,col:a}=gameState.selectedCell,0!==gameState.board[t][a]&&gameState.board[t][a]!==gameState.solution[t][a]&&(gameState.board[t][a]=0,gameState.emptyCells++,updateUI(),playSound("select"))):"ArrowUp"===e&&0<gameState.selectedCell.row?selectCell(gameState.selectedCell.row-1,gameState.selectedCell.col):"ArrowDown"===e&&gameState.selectedCell.row<8?selectCell(gameState.selectedCell.row+1,gameState.selectedCell.col):"ArrowLeft"===e&&0<gameState.selectedCell.col?selectCell(gameState.selectedCell.row,gameState.selectedCell.col-1):"ArrowRight"===e&&gameState.selectedCell.col<8&&selectCell(gameState.selectedCell.row,gameState.selectedCell.col+1))})}function loadStats(){var e=localStorage.getItem("sudokuStats");if(e)try{gameState.stats=JSON.parse(e)}catch(e){console.error("Failed to parse saved stats",e)}}function initPuzzle(){loadStats(),initNumberSelector(),setupEventListeners(),initBoard();var e=document.querySelector("#mute-btn .material-icons");e&&(e.textContent=gameState.isMuted?"volume_off":"volume_up")}export{initPuzzle};
