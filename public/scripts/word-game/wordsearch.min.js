function initWordGame(){var e=(e=localStorage.getItem("wordGameState"))?JSON.parse(e):null;let g=e?.difficulty||"easy",d=e?.consecutiveWins||0,c=e?.currentLevel||1,h=e?.metaProgression||{totalWordsFound:0,streaks:0,highestCombo:0,unlockedThemes:["default"],currentTheme:"default",powerUps:[],lastPlayed:null,dailyChallengeCompleted:!1},p={easy:{gridCols:6,gridRows:8,minWordLength:3,maxWordLength:5,wordCount:6,timeLimit:240,progressive:!1},medium:{gridCols:8,gridRows:10,minWordLength:4,maxWordLength:7,wordCount:8,timeLimit:300,progressive:!1},hard:{gridCols:10,gridRows:10,minWordLength:5,maxWordLength:8,wordCount:10,timeLimit:500,progressive:!0,minTimeLimit:300,maxWordCount:15},maxPlacementAttempts:200,maxTotalAttempts:1e3,maxRetries:3,specialRoundInterval:5},v=[],m=[],u=[],f=[],w=!1,s=new Set,y=0,L={horizontal:0,vertical:0,diagonal:0},C=p[g].timeLimit,M=null,E=null,T=null,r=document.getElementById("wordsearch-time")||((e=document.createElement("div")).id="wordsearch-time",e.className="word-game-timer",document.querySelector(".word-game-meta").appendChild(e),e),b=document.getElementById("wordsearch-grid"),S=document.getElementById("wordsearch-wordlist"),l=document.getElementById("wordsearch-words-left"),I=document.getElementById("wordsearch-feedback");var e=document.getElementById("wordsearch-new"),i=document.getElementById("wordsearch-hint");let k=document.getElementById("wordsearch-level"),x=document.getElementById("wordsearch-games-remaining"),t=document.querySelector("#mute-btn .material-icons"),a=document.getElementById("powerup-container"),o={select:new Audio("/audio/click.mp3"),found:new Audio("/audio/correct.mp3"),win:new Audio("/audio/win.mp3"),error:new Audio("/audio/wrong.mp3"),powerup:new Audio("/audio/powerup.mp3"),unlock:new Audio("/audio/unlock.mp3")},n=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1;function A(t){n||o[t]&&(o[t].currentTime=0,o[t].play().catch(e=>console.error(`Error playing ${t} sound:`,e)))}function $(){Object.keys(o).forEach(e=>{e=e,o[e]&&(o[e].pause(),o[e].currentTime=0)})}function W(){var e=Math.floor(C/60),t=C%60;r.textContent=`Time: ${e}:`+t.toString().padStart(2,"0"),r.style.color=C<=10?"#ff4444":"#ffffff"}function R(){var e={difficulty:g,consecutiveWins:d,currentLevel:c,metaProgression:h};localStorage.setItem("wordGameState",JSON.stringify(e))}function z(t,r){var o,e=[{id:0,type:"horizontal",rowStep:0,colStep:1},{id:1,type:"vertical",rowStep:1,colStep:0},{id:2,type:"diagonal",rowStep:1,colStep:1},{id:3,type:"diagonal",rowStep:-1,colStep:1}],a=e.filter(e=>!("horizontal"===e.type&&L.horizontal>=r.horizontal||"vertical"===e.type&&L.vertical>=r.vertical||"diagonal"===e.type&&L.diagonal>=r.diagonal));for(o of(e=>{var t=[...e];for(let e=t.length-1;0<e;e--){var r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t})([...0<a.length?a:e]))for(let e=0;e<p.maxPlacementAttempts;e++){var n=0===o.rowStep?p[g].gridRows:p[g].gridRows-t.letters.length*Math.abs(o.rowStep),l=0===o.colStep?p[g].gridCols:p[g].gridCols-t.letters.length*Math.abs(o.colStep),n=Math.floor(Math.random()*n),l=Math.floor(Math.random()*l);if(((e,o,a,n)=>{var l=e.letters;for(let r=0;r<l.length;r++){let e=o,t=a;switch(n){case 0:t+=r;break;case 1:e+=r;break;case 2:e+=r,t+=r;break;case 3:e-=r,t+=r}if(e<0||e>=p[g].gridRows||t<0||t>=p[g].gridCols)return;var i=e*p[g].gridCols+t;if(""!==v[i].letter&&v[i].letter!==l[r])return}return 1})(t,n,l,o.id)){u=m=h=c=d=s=i=void 0;var i=t,s=n,d=l,c=o.id,{word:h,letters:m}=i;for(let r=0;r<m.length;r++){let e=s,t=d;switch(c){case 0:t+=r;break;case 1:e+=r;break;case 2:e+=r,t+=r;break;case 3:e-=r,t+=r}var u=e*p[g].gridCols+t;v[u].letter=m[r],v[u].word=h}return L[o.type]++,1}}}function B(e){e.preventDefault(),w=!0;e=K(e.target);null!==e&&(f=[e],O(),A("select"))}function F(e){var t,r,o,a,n;e.preventDefault(),!w||0===f.length||null===(e=K(e.target))||f.includes(e)||(n=f[f.length-1],r=p[g].gridCols,a=Math.floor(n/r),n=n%r,t=Math.floor(e/r),r=e%r,f.length<2?Math.abs(t-a)<=1&&Math.abs(r-n)<=1&&(f.push(e),O()):(o=N())&&(a=a+o.row,n=n+o.col,Math.abs(t-a)<=.7)&&Math.abs(r-n)<=.7&&(f.push(e),O()))}function N(){var e,t,r,o;return f.length<2?null:(e=p[g].gridCols,t=f[0],o=f[f.length-1],r=Math.floor(t/e),t=t%e,r=Math.floor(o/e)-r,o=o%e-t,Math.abs(r)<=.5&&.5<Math.abs(o)?{row:0,col:Math.sign(o),type:"horizontal"}:Math.abs(o)<=.5&&.5<Math.abs(r)?{row:Math.sign(r),col:0,type:"vertical"}:{row:r/Math.max(Math.abs(r),Math.abs(o)),col:o/Math.max(Math.abs(r),Math.abs(o)),type:"diagonal"})}function G(){if(w){if(w=!1,3<=f.length){var t=N();if(t&&"diagonal"===t.type){var r=p[g].gridCols,e=f[0],o=Math.floor(e/r),a=e%r,n=[e];for(let e=1;e<f.length;e++){var l=Math.round(o+t.row*e),i=Math.round(a+t.col*e);0<=l&&l<p[g].gridRows&&0<=i&&i<p[g].gridCols&&n.push(l*r+i)}n.filter((e,t)=>t<f.length&&e===f[t]).length>=.7*f.length&&(f=n.slice(0,f.length))}}if(f.length<p[g].minWordLength)A("error");else{var e=f.map(e=>v[e].letter).join(""),s=e.split("").reverse().join("");let t=e.toUpperCase(),a=s.toUpperCase(),n=m.find(e=>e.word.toUpperCase()===t||e.word.toUpperCase()===a);if(n&&!u.includes(n.word)){u.push(n.word),A("found");let r=u.length%4,o=["rgba(122, 255, 195, 0.7)","rgba(142, 196, 250, 0.7)","rgba(255, 216, 117, 0.7)","rgba(255, 158, 232, 0.7)"];(n.word.toUpperCase()===a?f.reverse():f).forEach((e,t)=>{t<n.letters.length&&v[e].letter===n.letters[t]&&((t=v[e].element.style.backgroundColor)&&"transparent"!==t?(v[e].element.style.backgroundColor=o[r],v[e].element.style.boxShadow="inset 0 0 0 2px "+t):v[e].element.style.backgroundColor=o[r],v[e].element.classList.add("found"))});e=S.querySelector(`[data-word="${n.word}"]`);e&&e.remove(),J(),H("Found: "+n.word,"success"),u.length===m.length&&(()=>{var e;A("win"),clearInterval(M),clearInterval(T),h.totalWordsFound+=u.length,h.streaks++,h.highestCombo=Math.max(h.highestCombo,u.length),100<=h.totalWordsFound&&!h.unlockedThemes.includes("dark")&&(h.unlockedThemes.push("dark"),P("New Theme Unlocked: Dark Mode!"),A("unlock")),250<=h.totalWordsFound&&!h.unlockedThemes.includes("nature")&&(h.unlockedThemes.push("nature"),P("New Theme Unlocked: Nature!"),A("unlock")),h.streaks%5==0&&(e=["Extra Time","Word Reveal","Letter Highlight","Time Freeze"].find(e=>!h.powerUps.includes(e)))&&(h.powerUps.push(e),P(`New Power-Up: ${e}!`),A("unlock"));let t=document.createElement("div"),r=(t.className="victory-screen",V(),d++,c++,""),o=!1;"hard"!==g&&3<=d?("easy"===g?(g="medium",o=!0,r="🎉 Advanced to Medium level! 🎉"):"medium"===g&&(g="hard",o=!0,r="🏆 Advanced to Hard level! 🏆"),o&&(d=0,setTimeout(()=>V({particleCount:200,spread:100}),1e3))):r=`🎊 Level ${c-1} Complete! 🎊`,t.innerHTML=`
      <div class="victory-content">
        <h2>Victory!</h2>
        <p class="victory-message">${r}</p>
        <div class="victory-stats">
          <div>Words Found: ${u.length}/${m.length}</div>
          <div>Current Streak: ${h.streaks}</div>
          <div>Total Words Found: ${h.totalWordsFound}</div>
        </div>
        
        ${"hard"===g?`
        <div class="progression-container">
          <div class="progress-bar">
            <div class="progress" style="width: ${c%10*10}%"></div>
            ${Array.from({length:9},(e,t)=>`
              <div class="milestone" data-milestone="${t+1}" style="left: ${10*(t+1)}%"></div>
            `).join("")}
          </div>
          ${c%5==0?`
            <div class="unlock-notification">
              New ${c%10==0?"Theme":"Power-Up"} Unlocked!
            </div>
          `:""}
        </div>
        `:""}
        
        <div class="competitive-elements">
          <div class="leaderboard-preview">
            <h3>Top Players</h3>
            <ol>
              <li>WordMaster: Level 42</li>
              <li>PuzzleKing: Level 38</li>
              <li>${localStorage.getItem("playerName")||"You"}: Level ${c-1}</li>
            </ol>
          </div>
          <div class="action-buttons">
            <button class="btn primary continue-btn">Continue</button>
            <button class="btn secondary share-btn">Share</button>
          </div>
        </div>
      </div>
    `,document.body.appendChild(t),t.querySelector(".continue-btn").addEventListener("click",()=>{t.remove(),R(),U()}),t.querySelector(".share-btn").addEventListener("click",()=>{var e;e=`I just completed level ${c-1} in Word Search Master! Can you beat my score?`,navigator.share?navigator.share({title:"Word Search Master",text:e,url:window.location.href}).catch(e=>console.log("Error sharing:",e)):(e=`https://twitter.com/intent/tweet?text=${encodeURIComponent(e)}&url=`+encodeURIComponent(window.location.href),window.open(e,"_blank"))}),R()})()}else A("error"),H("Word not found in list","error")}f=[],O()}}function O(){if(v.forEach(e=>{e.element.classList.remove("selected"),e.element.classList.remove("direction-locked"),e.element.classList.remove("diagonal-hint")}),f.forEach(e=>{v[e].element.classList.add("selected")}),2<=f.length){let t=N();var e,r,o;t&&(f.forEach(e=>{v[e].element.classList.add("direction-locked"),"diagonal"===t.type&&v[e].element.classList.add("diagonal-hint")}),"diagonal"===t.type)&&1<f.length&&(e=p[g].gridCols,r=f[f.length-1],o=Math.floor(r/e)+t.row,r=r%e+t.col,0<=o)&&o<p[g].gridRows&&0<=r&&r<p[g].gridCols&&(o=o*e+r,v[o].element.classList.add("diagonal-hint"))}}function D(t){switch(clearInterval(T),E=t,b.classList.remove("time-attack","hidden-letters","moving-words"),t.name){case"Time Attack":C=Math.floor(C*t.modifyTime),b.classList.add("time-attack"),H(t.name+": "+t.description,"warning");break;case"Hidden Letters":Array.from(b.querySelectorAll(".wordsearch-cell")).forEach(e=>{Math.random()<t.hidePercentage&&(e.classList.add("hidden-letter"),t.revealOnHover)&&e.addEventListener("mouseenter",()=>{e.classList.remove("hidden-letter")})}),b.classList.add("hidden-letters"),H(t.name+": "+t.description,"warning");break;case"Moving Words":T=setInterval(()=>{if(!w){{let e=m.filter(e=>!u.includes(e.word)),t=[];v.forEach(t=>{t.word&&e.some(e=>e.word===t.word)&&(t.letter="",t.word=null)}),e.forEach(e=>{z(e,{horizontal:Math.floor(p.hard.wordCount/3),vertical:Math.floor(p.hard.wordCount/3),diagonal:p.hard.wordCount-2*Math.floor(p.hard.wordCount/3)})&&t.push(e)}),j()}H("Words have shifted positions!","warning")}},t.shuffleInterval),b.classList.add("moving-words"),H(t.name+": "+t.description,"warning")}}function q(e,t){var r={Technology:["ALGORITHM","DATABASE","FUNCTION","NETWORK","ROUTER","VARIABLE","BROWSER","PROTOCOL"],Nature:["WATERFALL","MOUNTAIN","SUNFLOWER","HURRICANE","ECOSYSTEM","VOLCANO","GLACIER","CAVERN"],Science:["MOLECULE","GRAVITY","QUANTUM","PARTICLE","ELEMENT","FISSION","KINETIC","THERMODYNAMICS"],Geography:["CONTINENT","PENINSULA","LONGITUDE","LATITUDE","ARCHIPELAGO","POPULATION","ATMOSPHERE","PRECIPITATION"],Literature:["METAPHOR","SYMBOLISM","PROTAGONIST","ANTAGONIST","ALLITERATION","FORESHADOW","PAPERBACK","BIBLIOGRAPHY"]};return(r[e]||r.Technology).filter(e=>e.length>=t.minWordLength&&e.length<=t.maxWordLength).map(e=>({word:e,letters:e.split("")}))}function Y(){a&&(a.innerHTML="",h.powerUps.forEach((r,o)=>{var e=document.createElement("button");e.className="powerup-btn",e.textContent=r,e.dataset.powerup=r.toLowerCase().replace(" ","-"),e.addEventListener("click",()=>{var e=r,t=o;switch(A("powerup"),e){case"Extra Time":C+=30,W(),H("+30 seconds!","success");break;case"Word Reveal":let e=m.filter(e=>!u.includes(e.word));0<e.length&&H("One word is: "+e[0].word,"info");break;case"Letter Highlight":let e=m.filter(e=>!u.includes(e.word));if(0<e.length){let r=e[0].letters[0];v.forEach((e,t)=>{e.letter===r&&(e.element.classList.add("highlight-letter"),setTimeout(()=>{e.element.classList.remove("highlight-letter")},3e3))}),H("Look for words starting with "+r,"info")}}h.powerUps.splice(t,1),Y(),R()}),a.appendChild(e)}))}async function U(){var e,t,r;console.log("Initializing game with state:",{difficulty:g,currentLevel:c,consecutiveWins:d,metaProgression:h}),I.innerHTML=`
      <div class="loading-animation">
        <div class="loading-spinner"></div>
        <div class="loading-text">Creating your puzzle</div>
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    `,I.className="word-feedback info",H("","info"),b.innerHTML="",S.innerHTML="",f=[],u=[],w=!1,s.clear(),L={horizontal:0,vertical:0,diagonal:0},clearInterval(T),E=null,k&&(k.textContent=`Level: ${c} (${g})`),"hard"!==g?(e=3-d,x.textContent=0<e?"Wins to next difficulty: "+e:"Ready to advance difficulty!"):x.textContent="Max difficulty reached!",document.querySelectorAll(".progress-bar").forEach(e=>{e=e.querySelector(".progress");e&&(e.style.width=c%10*10+"%")}),b.dataset.theme!==h.currentTheme&&(b.dataset.theme=h.currentTheme),Y();try{var o,a,n="hard"===g?"hard"===g&&p.hard.progressive?(r=Math.floor(c/5),{...p.hard,wordCount:Math.min(p.hard.maxWordCount,p.hard.wordCount+r),timeLimit:Math.max(p.hard.minTimeLimit,p.hard.timeLimit-20*r)}):p.hard:p[g],l=((m=await(async t=>{var r=(r=["Technology","Nature","Science","Geography","Literature"])[Math.floor(c/3)%r.length];try{return(await(await fetch(`/api/words?theme=${r}&minLength=${t.minWordLength}&maxLength=`+t.maxWordLength)).json()).map(e=>({word:e.toUpperCase(),letters:e.toUpperCase().split("")}))}catch(e){return console.error("Error fetching themed words:",e),q(r,t)}})(n)).sort((e,t)=>t.letters.length-e.letters.length),v=Array(n.gridCols*n.gridRows).fill().map(()=>({letter:"",element:null,word:null})),{horizontal:Math.floor(n.wordCount/3),vertical:Math.floor(n.wordCount/3),diagonal:n.wordCount-2*Math.floor(n.wordCount/3)}),i=[];for(o of m)z(o,l)&&(i.push(o),s.add(o.word));m=i;{let r="ABCDEFGHIJKLMNOPQRSTUVWXYZ";v.forEach((e,t)=>{""===e.letter&&(e.letter=r[Math.floor(Math.random()*r.length)])})}j(),S.innerHTML="",[...m].sort((e,t)=>e.word.localeCompare(t.word)).forEach(e=>{var t=document.createElement("div");t.className="wordsearch-word",t.textContent=e.word,t.dataset.word=e.word,S.appendChild(t)}),ee(),C=n.timeLimit,"hard"===g&&c%p.specialRoundInterval==0&&(a=Math.floor(c/(2*p.specialRoundInterval))+1,D((t=[{name:"Time Attack",description:"30% less time but bonus points!",modifyTime:.7,scoreMultiplier:1.5},{name:"Hidden Letters",description:"Random letters are hidden!",hidePercentage:.3,revealOnHover:!0},{name:"Moving Words",description:"Words shift positions every 30 seconds!",shuffleInterval:3e4,preserveFound:!0}])[Math.min(a-1,t.length-1)])),clearInterval(M),W(),M=setInterval(()=>{C--,W(),C<=0&&(clearInterval(M),H("Time's up!","error"),h.streaks=0,setTimeout(U,2e3))},1e3),J(),H(`Find ${m.length} hidden words!`,"info"),y=0}catch(e){console.error("Game initialization failed:",e),I.innerHTML=`
      <div class="error-animation">
        <div class="error-icon">⚠️</div>
        <div class="loading-text">Setting up the board</div>
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    `,I.className="word-feedback error",++y>=p.maxRetries?(I.innerHTML=`
      <div class="error-animation">
        <div class="error-icon">❌</div>
        <div>Having trouble loading</div>
        <button class="btn primary" onclick="initWordGame()">Try Again</button>
      </div>
    `,I.className="word-feedback error"):setTimeout(()=>{(m=q("Technology",p[g])).sort((e,t)=>t.letters.length-e.letters.length),U()},2e3)}}function j(){b.style.setProperty("--cols",p[g].gridCols),b.style.setProperty("--rows",p[g].gridRows),b.style.display="grid";var e=Math.min(window.innerWidth,600)/p[g].gridCols;let o=Math.min(e,50);var e=o*p[g].gridCols,t=o*p[g].gridRows;b.style.width=e+"px",b.style.height=t+"px",b.style.maxWidth="100%",b.style.overflow="hidden",b.innerHTML="",v.forEach((e,t)=>{var r=document.createElement("div");r.className="wordsearch-cell",r.textContent=e.letter,r.dataset.index=t,r.style.width=o+"px",r.style.height=o+"px",r.style.fontSize=Math.min(.6*o,16)+"px",r.style.borderRadius="0",r.addEventListener("mousedown",B),r.addEventListener("mouseenter",F),r.addEventListener("mouseup",G),r.addEventListener("touchstart",X,{passive:!1}),r.addEventListener("touchmove",_,{passive:!1}),r.addEventListener("touchend",Q),b.appendChild(r),e.element=r})}function P(e){let t=document.createElement("div");t.className="unlock-notification",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.classList.add("show")},100),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),500)},3e3)}function V(e={}){let t={particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]};confetti({...t,...e}),.5<Math.random()&&setTimeout(()=>{confetti({...t,...e,angle:180*Math.random()-90,origin:{x:Math.random(),y:.6}})},300)}function J(){l.textContent=`Words: ${m.length-u.length}/`+m.length}function H(e,t){I.textContent=e,I.className="word-feedback "+t}function K(e){return e.classList.contains("wordsearch-cell")?parseInt(e.dataset.index):null}function X(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("wordsearch-cell")&&B({target:e,preventDefault:()=>{}})}function _(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("wordsearch-cell")&&F({target:e,preventDefault:()=>{}})}function Q(e){e.preventDefault(),G()}function Z(){var e=document.querySelector(".word-game-card");e&&(window.innerWidth<=768?(e.style.width="100%",e.style.margin="0",e.style.padding="1rem",e.style.minHeight="calc(100vh - 80px)",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center"):(e.style.width="600px",e.style.margin="2rem auto",e.style.padding="2rem",e.style.minHeight="auto",e.style.display="block")),ee()}function ee(){var e=S.parentElement;window.innerWidth<=768?(S.style.width="100%",S.style.maxWidth="100%",S.style.overflowX="auto",S.style.whiteSpace="nowrap",S.style.marginTop="1rem",S.style.padding="0.5rem",S.style.display="flex",S.style.flexWrap="wrap",S.style.justifyContent="center",S.querySelectorAll(".wordsearch-word").forEach(e=>{e.style.display="inline-block",e.style.margin="0.25rem 0.5rem",e.style.fontSize="14px"}),e&&(e.style.display="block",e.style.width="100%",e.style.overflow="visible")):(S.style.width="auto",S.style.maxWidth="none",S.style.overflowX="visible",S.style.whiteSpace="normal",S.style.marginTop="0",S.style.padding="0",S.style.display="grid",S.style.gridTemplateColumns="repeat(2, 1fr)",S.style.gap="0.5rem",S.querySelectorAll(".wordsearch-word").forEach(e=>{e.style.display="block",e.style.margin="0.5rem 0",e.style.fontSize="16px"}),e&&(e.style.display="block",e.style.width="auto",e.style.overflow="visible"))}U(),n=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,t&&(t.textContent=n?"volume_off":"volume_up"),n&&$(),e.addEventListener("click",U),i.addEventListener("click",function(){var e=m.filter(e=>!u.includes(e.word));0<e.length?H(`Try looking for a word starting with ${e[Math.floor(Math.random()*e.length)].word.slice(0,2)}...`,"info"):H("You found all words!","success")});e=document.getElementById("mute-btn");e&&e.addEventListener("click",()=>{n=!n,localStorage.setItem("triviaMasterMuteState",n),t&&(t.textContent=n?"volume_off":"volume_up"),n&&$()}),window.addEventListener("resize",Z),Z()}document.addEventListener("DOMContentLoaded",()=>{initWordGame()});export{initWordGame};
