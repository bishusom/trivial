function initWordGame(){var e=(()=>{var e=localStorage.getItem("wordGameState");if(e)try{var t=JSON.parse(e);if(["easy","medium","hard"].includes(t.difficulty)&&"number"==typeof t.consecutiveWins&&"number"==typeof t.currentLevel)return t}catch(e){console.error("Invalid saved game state",e)}return null})();let g=e?.difficulty||"easy",h=e?.consecutiveWins||0,m=e?.currentLevel||1,f={easy:{gridCols:6,gridRows:8,minWordLength:3,maxWordLength:5,wordCount:6,timeLimit:240},medium:{gridCols:8,gridRows:10,minWordLength:4,maxWordLength:7,wordCount:8,timeLimit:300},hard:{gridCols:10,gridRows:10,minWordLength:5,maxWordLength:8,wordCount:10,timeLimit:500},maxPlacementAttempts:200,maxTotalAttempts:1e3,maxRetries:3},p=[],w=[],v=[],y=[],o=!1,E=new Set,t=0,C={horizontal:0,vertical:0,diagonal:0},r=f[g].timeLimit,S=null,U=document.getElementById("wordsearch-time")||((e=document.createElement("div")).id="wordsearch-time",e.className="word-game-timer",document.querySelector(".word-game-meta").appendChild(e),e),L=document.getElementById("wordsearch-grid"),M=document.getElementById("wordsearch-wordlist"),B=document.getElementById("wordsearch-words-left"),n=document.getElementById("wordsearch-feedback");var e=document.getElementById("wordsearch-new"),z=document.getElementById("wordsearch-hint");let T=document.getElementById("wordsearch-level"),x=document.getElementById("wordsearch-games-remaining"),a=document.querySelector("#mute-btn .material-icons"),l={select:new Audio("/audio/click.mp3"),found:new Audio("/audio/correct.mp3"),win:new Audio("/audio/win.mp3"),error:new Audio("/audio/wrong.mp3")},i=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1;function R(t){i?console.log(`Sound ${t} skipped: muted`):(console.log("Playing sound: "+t),l[t]&&(l[t].currentTime=0,l[t].play().catch(e=>console.error(`Error playing ${t} sound:`,e))))}function d(){Object.keys(l).forEach(e=>{e=e,l[e]&&(l[e].pause(),l[e].currentTime=0)})}function A(e,t,r,o){"undefined"!=typeof gtag&&gtag("event",e,{event_category:t,event_label:r,value:o})}function I(){var e=Math.floor(r/60),t=r%60;U.textContent=`Time: ${e}:`+t.toString().padStart(2,"0")}n||((n=document.createElement("div")).id="wordsearch-feedback",n.className="word-feedback",document.querySelector(".game-body").appendChild(n));var s=document.querySelector(".word-game-meta");function c(){var e={difficulty:g,consecutiveWins:h,currentLevel:m};localStorage.setItem("wordGameState",JSON.stringify(e))}async function b(){console.log("Initializing game with state:",{difficulty:g,currentLevel:m,consecutiveWins:h}),n.innerHTML=`
    <div class="loading-animation">
      <div class="loading-spinner"></div>
      <div class="loading-text">Creating your puzzle</div>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  `,n.className="word-feedback info",D("","info"),L.innerHTML="",M.innerHTML="",y=[],v=[],o=!1,E.clear(),C={horizontal:0,vertical:0,diagonal:0};var e=document.querySelector(".word-game-meta");e&&!document.getElementById("wordsearch-level")&&(e.appendChild(T),e.appendChild(x)),W();try{(w=await N(f[g])).sort((e,t)=>t.letters.length-e.letters.length),console.log("Words fetched and sorted:",w);let o=!1,n=0;for(;!o&&n<3;){n++,console.log(`Attempt ${n} to place all words`),p=Array(f[g].gridCols*f[g].gridRows).fill().map(()=>({letter:"",element:null,word:null}));let e=[],t=0,r=[...w];for(var a=f[g].wordCount,l=Math.floor(a/3),i={horizontal:l,vertical:l,diagonal:a-2*l};e.length<f[g].wordCount&&t<f.maxTotalAttempts;){var d=(r=0===r.length?[...w].filter(t=>!e.some(e=>e.word===t.word)):r)[0];O(d,i)?(e.push(d),E.add(d.word),r.shift()):(r.shift(),t++)}if((w=e).length<f[g].wordCount){console.warn(`Only placed ${w.length} out of ${f[g].wordCount} words`);var s=f[g].wordCount-w.length,c=(await N(f[g],s)).filter(e=>!E.has(e.word));let e=0;for(;w.length<f[g].wordCount&&e<f.maxTotalAttempts&&0<c.length;){var u=c[0];O(u,i)?(w.push(u),E.add(u.word),c.shift()):(c.shift(),e++)}}w.length===f[g].wordCount?o=!0:(console.warn("Failed to place all words on attempt "+n),E.clear(),(w=await N(f[g])).sort((e,t)=>t.letters.length-e.letters.length),C={horizontal:0,vertical:0,diagonal:0})}if(!o)throw new Error(`Could only place ${w.length} out of ${f[g].wordCount} words after 3 attempts`);{let r="ABCDEFGHIJKLMNOPQRSTUVWXYZ";p.forEach((e,t)=>{""===e.letter&&(e.letter=r[Math.floor(Math.random()*r.length)])})}{L.style.setProperty("--cols",f[g].gridCols),L.style.setProperty("--rows",f[g].gridRows),L.style.display="grid";let e=Math.min(window.innerWidth,600),t=e/f[g].gridCols,o=Math.min(t,50),r=o*f[g].gridCols,n=o*f[g].gridRows;L.style.width=r+"px",L.style.height=n+"px",L.style.maxWidth="100%",L.style.overflow="hidden",L.innerHTML="",p.forEach((e,t)=>{var r=document.createElement("div");r.className="wordsearch-cell",r.textContent=e.letter,r.dataset.index=t,r.style.width=o+"px",r.style.height=o+"px",r.style.fontSize=Math.min(.6*o,16)+"px",r.style.borderRadius="0",r.addEventListener("mousedown",H),r.addEventListener("mouseenter",e=>{e.preventDefault(),$(e),R("select")}),r.addEventListener("mouseup",_),r.addEventListener("touchstart",V,{passive:!1}),r.addEventListener("touchmove",Y,{passive:!1}),r.addEventListener("touchend",J),L.appendChild(r),e.element=r})}M.innerHTML="",[...w].sort((e,t)=>e.word.localeCompare(t.word)).forEach(e=>{var t=document.createElement("div");t.className="wordsearch-word",t.textContent=e.word,t.dataset.word=e.word,M.appendChild(t)}),j(),G(),W(),D(`Find ${w.length} hidden words!`,"info"),clearInterval(S),r=f[g].timeLimit,I(),S=setInterval(()=>{r--,I(),r<=0&&(clearInterval(S),D("Time's up!","error"),setTimeout(b,2e3))},1e3),t=0}catch(e){if(console.error("Game initialization failed:",e),n.innerHTML=`
    <div class="error-animation">
      <div class="error-icon">⚠️</div>
      <div class="loading-text">Setting up the board</div>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  `,n.className="word-feedback error",++t>=f.maxRetries)return n.innerHTML=`
    <div class="error-animation">
      <div class="error-icon">❌</div>
      <div>Having trouble loading</div>
      <button class="btn primary" onclick="initWordGame()">Try Again</button>
    </div>
  `,void(n.className="word-feedback error");setTimeout(()=>{var e=["FUNCTION","VARIABLE","OPERATOR","QUERY","JAVASCRIPT","REACT","ANGULAR","COMPONENT","MODULE","SCRIPT","CODING","DEBUG","ARRAY","LOOP","METHOD","CLASS","STRING","NUMBER","OBJECT","EVENT","STYLE","DESIGN","FORMAT","UPDATE","INSERT","DELETE","SELECT","TABLE","INDEX","FETCH","ROUTE","SERVER"].filter(e=>e.length>=f[g].minWordLength&&e.length<=f[g].maxWordLength),e=[...new Set(e)].filter(e=>!E.has(e));(w=k(e).slice(0,f[g].wordCount).map(e=>({word:e,letters:e.split("")}))).sort((e,t)=>t.letters.length-e.letters.length),b()},2e3)}A("word_search_started","word_search",1)}async function N(o,n=null){try{var a=Math.floor(9e5*Math.random()),e=n||o.wordCount,l=await db.collection("dictionary").where("length",">=",o.minWordLength).where("length","<=",o.maxWordLength).where("randomIndex",">=",a).orderBy("randomIndex").limit(e).get();if(l.empty)throw new Error("No words found in dictionary");let t=new Set,r=[];if(l.forEach(e=>{var e=e.data();e.word&&e.letters&&(e=e.word.toUpperCase(),E.has(e)||(t.add(e),r.push({word:e,letters:e.split("").map(e=>e.toUpperCase())})))}),0===t.size)throw new Error("No valid words found");return k(r).slice(0,n||o.wordCount)}catch(e){console.error("Error fetching words:",e);a=["FUNCTION","VARIABLE","OPERATOR","QUERY","JAVASCRIPT","REACT","ANGULAR","COMPONENT","MODULE","SCRIPT","CODING","DEBUG","ARRAY","LOOP","METHOD","CLASS","STRING","NUMBER","OBJECT","EVENT","STYLE","DESIGN","FORMAT","UPDATE","INSERT","DELETE","SELECT","TABLE","INDEX","FETCH","ROUTE","SERVER"].filter(e=>e.length>=o.minWordLength&&e.length<=o.maxWordLength);return k([...new Set(a)].filter(e=>!E.has(e))).slice(0,n||o.wordCount).map(e=>({word:e,letters:e.split("")}))}}function O(t,r){var o,e=[{id:0,type:"horizontal",rowStep:0,colStep:1},{id:1,type:"vertical",rowStep:1,colStep:0},{id:2,type:"diagonal",rowStep:1,colStep:1},{id:3,type:"diagonal",rowStep:-1,colStep:1}],n=e.filter(e=>!("horizontal"===e.type&&C.horizontal>=r.horizontal||"vertical"===e.type&&C.vertical>=r.vertical||"diagonal"===e.type&&C.diagonal>=r.diagonal));for(o of k([...0<n.length?n:e]))for(let e=0;e<50;e++){var a=0===o.rowStep?f[g].gridRows:f[g].gridRows-t.letters.length*Math.abs(o.rowStep),l=0===o.colStep?f[g].gridCols:f[g].gridCols-t.letters.length*Math.abs(o.colStep),a=Math.floor(Math.random()*a),l=Math.floor(Math.random()*l);if(((e,o,n,a)=>{var l=e.letters;for(let r=0;r<l.length;r++){let e=o,t=n;switch(a){case 0:t+=r;break;case 1:e+=r;break;case 2:e+=r,t+=r;break;case 3:e-=r,t+=r}if(e<0||e>=f[g].gridRows||t<0||t>=f[g].gridCols)return;var i=e*f[g].gridCols+t;if(""!==p[i].letter&&p[i].letter!==l[r])return}return 1})(t,a,l,o.id)){m=h=u=c=s=d=i=void 0;var i=t,d=a,s=l,c=o.id,{word:u,letters:h}=i;for(let r=0;r<h.length;r++){let e=d,t=s;switch(c){case 0:t+=r;break;case 1:e+=r;break;case 2:e+=r,t+=r;break;case 3:e-=r,t+=r}var m=e*f[g].gridCols+t;p[m].letter=h[r],p[m].word=u}return"horizontal"===o.type?C.horizontal++:"vertical"===o.type?C.vertical++:"diagonal"===o.type&&C.diagonal++,1}}}function P(){if(y.length<f[g].minWordLength)R("error");else{var e=y.map(e=>p[e].letter).join(""),r=e.split("").reverse().join("");let t=e.toUpperCase(),n=r.toUpperCase(),a=w.find(e=>e.word.toUpperCase()===t||e.word.toUpperCase()===n);if(a&&!v.includes(a.word)){v.push(a.word),R("found");let r=v.length%4,o=["#7AFFC3","#8EC4FA","#FFD875","#FF9EE8"];(a.word.toUpperCase()===n?y.reverse():y).forEach((e,t)=>{t<a.letters.length&&p[e].letter===a.letters[t]&&(p[e].element.style.backgroundColor=o[r],p[e].element.classList.add("found"))});e=M.querySelector(`[data-word="${a.word}"]`);if(e&&e.remove(),G(),D("Found: "+a.word,"success"),v.length===w.length){R("win");let e=document.createElement("div"),t=(e.className="victory-screen",F(),h++,m++,""),r=!1,o=(3<=h?(t="easy"===g?(g="medium",r=!0,"🎉 Advanced to Medium level! 🎉"):"medium"===g?(g="hard",r=!0,"🏆 Advanced to Hard level! 🏆"):"👑 Mastered Hard level! Continuing at max difficulty. 👑",r&&(h=0,setTimeout(()=>F({particleCount:200,spread:100}),1e3))):t=`🎊 Level ${m} Complete! 🎊`,e.innerHTML=`
      <h2>Victory!</h2>
      <p>${t}</p>
      <p>Words Found: ${v.length}</p>
      <div class="countdown">Proceeding to the next level in 5...</div>
    `,document.body.appendChild(e),5),n=e.querySelector(".countdown"),a=setInterval(()=>{o--,n.textContent=`Proceeding to the next level in ${o}...`,o<=0&&(clearInterval(a),e.remove(),c(),W(),b())},1e3);A("level_complete","word_search",g,v.length),c(),W()}}else R("error"),D("Word not found in list","error")}y=[],u()}function F(e={}){let t={particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]};confetti({...t,...e}),.5<Math.random()&&setTimeout(()=>{confetti({...t,...e,angle:180*Math.random()-90,origin:{x:Math.random(),y:.6}})},300)}function W(){var e;T&&(T.textContent=`Level: ${m} (${g})`),"hard"!==g?(e=3-h,x.textContent=0<e?"Wins to next difficulty: "+e:"Ready to advance difficulty!"):x.textContent="Max difficulty reached!"}function G(){B.textContent=`Words: ${w.length-v.length}/`+w.length}function D(e,t){n.textContent=e,n.className="word-feedback "+t}function k(e){var t=[...e];for(let e=t.length-1;0<e;e--){var r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}function H(e){e.preventDefault(),o=!0;e=q(e.target);null!==e&&(y=[e],u(),R("select"))}function $(e){var t,r;e.preventDefault(),!o||0===y.length||null===(e=q(e.target))||y.includes(e)||(t=y[y.length-1],r=(()=>{if(!(y.length<2)){var e=y[0],t=y[1],r=f[g].gridCols,o=Math.floor(e/r),e=e%r,o=Math.floor(t/r)-o,t=t%r-e;if(0==o&&0!=t)return{type:"horizontal",row:0,col:Math.sign(t)};if(0==t&&0!=o)return{type:"vertical",row:Math.sign(o),col:0};if(Math.abs(o)===Math.abs(t)&&0!=o)return{type:"diagonal",row:Math.sign(o),col:Math.sign(t)}}return null})(),1<y.length&&!((e,t,r)=>{if(!r)return 1;var o=f[g].gridCols,n=Math.floor(e/o),e=e%o,a=Math.floor(t/o)-n,l=(t=t%o)-e,i=Math.abs(a)<=1&&Math.abs(l)<=1;if(y.length<2)return i;switch(r.type){case"horizontal":return 0==a&&Math.sign(l)===r.col;case"vertical":return 0==l&&Math.sign(a)===r.row;case"diagonal":return Math.abs(a)===Math.abs(l)&&Math.sign(a)===r.row&&Math.sign(l)===r.col&&i;default:return}})(t,e,r))||(y.push(e),u())}function _(){o&&(o=!1,P())}function q(e){return e.classList.contains("wordsearch-cell")?parseInt(e.dataset.index):null}function u(){p.forEach(e=>{e.element.classList.remove("selected")}),y.forEach(e=>{p[e].element.classList.add("selected")})}function V(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("wordsearch-cell")&&H({target:e,preventDefault:()=>{}})}function Y(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("wordsearch-cell")&&$({target:e,preventDefault:()=>{}})}function J(e){e.preventDefault(),_()}function X(){var e=document.querySelector(".word-game-card");e&&(window.innerWidth<=768?(e.style.width="100%",e.style.margin="0",e.style.padding="1rem",e.style.minHeight="calc(100vh - 80px)",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center"):(e.style.width="600px",e.style.margin="2rem auto",e.style.padding="2rem",e.style.minHeight="auto",e.style.display="block")),j()}function j(){var e=M.parentElement;window.innerWidth<=768?(M.style.width="100%",M.style.maxWidth="100%",M.style.overflowX="auto",M.style.whiteSpace="nowrap",M.style.marginTop="1rem",M.style.padding="0.5rem",M.style.display="flex",M.style.flexWrap="wrap",M.style.justifyContent="center",M.querySelectorAll(".wordsearch-word").forEach(e=>{e.style.display="inline-block",e.style.margin="0.25rem 0.5rem",e.style.fontSize="14px"}),e&&(e.style.display="block",e.style.width="100%",e.style.overflow="visible")):(M.style.width="auto",M.style.maxWidth="none",M.style.overflowX="visible",M.style.whiteSpace="normal",M.style.marginTop="0",M.style.padding="0",M.style.display="grid",M.style.gridTemplateColumns="repeat(2, 1fr)",M.style.gap="0.5rem",M.querySelectorAll(".wordsearch-word").forEach(e=>{e.style.display="block",e.style.margin="0.5rem 0",e.style.fontSize="16px"}),e&&(e.style.display="block",e.style.width="auto",e.style.overflow="visible"))}s&&(s.appendChild(T),s.appendChild(x)),W(),b(),i=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,a&&(a.textContent=i?"volume_off":"volume_up"),i&&d(),e.addEventListener("click",b),z.addEventListener("click",function(){var e=w.filter(e=>!v.includes(e.word));0<e.length?D(`Try looking for a word starting with ${e[Math.floor(Math.random()*e.length)].word.slice(0,2)}...`,"info"):D("You found all words!","success")});s=document.getElementById("mute-btn");s&&s.addEventListener("click",()=>{i=!i,localStorage.setItem("triviaMasterMuteState",i),a&&(a.textContent=i?"volume_off":"volume_up"),i&&d()}),window.addEventListener("resize",X),X()}document.addEventListener("DOMContentLoaded",()=>{initWordGame()});export{initWordGame};
