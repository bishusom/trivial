let GAME_CONFIG={winsNeededForLevelUp:3,baseRange:20,rangeIncrement:10,baseAttempts:6,baseHints:2,pointsPerLevel:50,timeLimit:60},puzzleState={targetNumber:0,attemptsLeft:GAME_CONFIG.baseAttempts,maxAttempts:GAME_CONFIG.baseAttempts,minRange:1,maxRange:GAME_CONFIG.baseRange,guesses:[],hintsUsed:0,maxHints:GAME_CONFIG.baseHints,level:1,winsThisLevel:0,points:0,timerStart:null,timerEnd:null,timerInterval:null,timeLeft:GAME_CONFIG.timeLimit,currentChallenge:null,gameStarted:!1,isMuted:JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,unlockedFeatures:{doublePoints:!1,extraHints:!1,timeBonus:!1}},CHALLENGES=[{name:"Blind Mode",description:"No feedback after guesses!",modifier:e=>{e.blindMode=!0}},{name:"Speed Run",description:"Solve in under 30 seconds for bonus!",modifier:e=>{e.speedRun=!0}},{name:"Precision",description:"Number range doubled!",modifier:e=>{e.maxRange*=2}}],audioElements={select:new Audio("/audio/click.mp3"),found:new Audio("/audio/correct.mp3"),win:new Audio("/audio/win.mp3"),error:new Audio("/audio/wrong.mp3")};function playSound(t){puzzleState.isMuted?console.log(`Sound ${t} skipped: muted`):audioElements[t]&&(audioElements[t].currentTime=0,audioElements[t].play().catch(e=>console.error(`Error playing ${t} sound:`,e)))}function stopSound(e){audioElements[e]&&(audioElements[e].pause(),audioElements[e].currentTime=0)}function stopAllSounds(){Object.keys(audioElements).forEach(e=>stopSound(e))}function trackEvent(e,t,a,n){"undefined"!=typeof gtag&&gtag("event",e,{event_category:t,event_label:a,value:n})}function startTimer(){console.log("Starting timer"),puzzleState.timerInterval&&clearInterval(puzzleState.timerInterval),puzzleState.timeLeft=GAME_CONFIG.timeLimit,updateTimer(),puzzleState.timerInterval=setInterval(()=>{var e;console.log("Timer tick: "+puzzleState.timeLeft),puzzleState.timeLeft=Math.max(0,puzzleState.timeLeft-1),updateTimer(),puzzleState.timeLeft<=0&&(console.log("Timer expired"),clearInterval(puzzleState.timerInterval),puzzleState.timerInterval=null,(e=document.getElementById("puzzle-feedback"))&&(e.textContent="Time's up!",e.className="puzzle-feedback feedback-wrong"),puzzleState.winsThisLevel=0,playSound("error"),setTimeout(startNewPuzzle,2e3))},1e3)}function updateTimer(){var e,t,a=document.getElementById("puzzle-time");a?(e=Math.floor(puzzleState.timeLeft/60),t=puzzleState.timeLeft%60,a.textContent=`Time: ${e}:`+t.toString().padStart(2,"0"),a.className="timer-value "+(puzzleState.timeLeft<=10?"time-critical":"")):console.warn("Timer element not found")}function showConfetti(t={}){if(console.log("Triggering confetti"),"undefined"==typeof confetti)console.error("Confetti library not loaded");else{let e={particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]};confetti({...e,...t}),.5<Math.random()&&setTimeout(()=>{confetti({...e,...t,angle:180*Math.random()-90,origin:{x:Math.random(),y:.6}})},300)}}function startNewPuzzle(){var e=GAME_CONFIG.baseRange+(puzzleState.level-1)*GAME_CONFIG.rangeIncrement;puzzleState.minRange=1,puzzleState.maxRange=e,puzzleState.targetNumber=Math.floor(Math.random()*e)+1,puzzleState.attemptsLeft=GAME_CONFIG.baseAttempts+Math.floor(puzzleState.level/3),puzzleState.maxAttempts=puzzleState.attemptsLeft,puzzleState.guesses=[],puzzleState.hintsUsed=0,puzzleState.maxHints=puzzleState.unlockedFeatures.extraHints?3:GAME_CONFIG.baseHints,puzzleState.timerStart=null,puzzleState.timerEnd=null,puzzleState.gameStarted=!1,puzzleState.blindMode=!1,puzzleState.speedRun=!1,(puzzleState.level%3==0?(puzzleState.currentChallenge=CHALLENGES[Math.floor(Math.random()*CHALLENGES.length)],puzzleState.currentChallenge.modifier(puzzleState),showChallengeBanner):(puzzleState.currentChallenge=null,hideChallengeBanner))(),updatePuzzleUI();let t=document.getElementById("number-guess");e=document.getElementById("puzzle-feedback");t&&(t.value="",t.min=puzzleState.minRange,t.max=puzzleState.maxRange,t.placeholder=`Guess (${puzzleState.minRange}-${puzzleState.maxRange})`),e&&(e.textContent="",e.className="puzzle-feedback"),startTimer(),setTimeout(()=>{t&&t.focus()},100)}function showChallengeBanner(){var e=document.getElementById("challenge-banner"),t=document.getElementById("challenge-description");e&&t&&puzzleState.currentChallenge&&(e.classList.remove("hidden"),t.textContent=puzzleState.currentChallenge.description)}function hideChallengeBanner(){var e=document.getElementById("challenge-banner");e&&e.classList.add("hidden")}function calculateScore(){if(!puzzleState.timerStart)return 0;var e=(puzzleState.timerEnd-puzzleState.timerStart)/1e3,t=puzzleState.speedRun?30:60;let a=GAME_CONFIG.pointsPerLevel*puzzleState.level,n=5*Math.max(0,t-e);var t=30*puzzleState.hintsUsed,e=puzzleState.currentChallenge?200:0,l=Math.floor(puzzleState.maxRange/10);return puzzleState.unlockedFeatures.doublePoints&&(a*=2),puzzleState.unlockedFeatures.timeBonus&&(n*=1.5),Math.floor(a+n+e+l-t)}function handleGuessSubmit(){var e=document.getElementById("number-guess");let t=document.getElementById("puzzle-feedback");var a,n,l=parseInt(e.value);!puzzleState.gameStarted&&!isNaN(l)&&l>=puzzleState.minRange&&l<=puzzleState.maxRange&&(puzzleState.timerStart=Date.now(),puzzleState.gameStarted=!0,playSound("select")),isNaN(l)?t&&(t.textContent="Please enter a valid number",t.className="puzzle-feedback feedback-wrong",playSound("error")):l<puzzleState.minRange||l>puzzleState.maxRange?t&&(t.textContent=`Please enter between ${puzzleState.minRange} and `+puzzleState.maxRange,t.className="puzzle-feedback feedback-wrong",playSound("error")):(puzzleState.guesses.push(l),puzzleState.attemptsLeft--,l===puzzleState.targetNumber?(puzzleState.timerEnd=Date.now(),clearInterval(puzzleState.timerInterval),puzzleState.timerInterval=null,puzzleState.winsThisLevel++,n=calculateScore(),puzzleState.points+=n,a=puzzleState.timerStart?(puzzleState.timerEnd-puzzleState.timerStart)/1e3:0,t&&(t.innerHTML=`
                <div class="feedback-message">
                    <strong>ðŸŽ‰ Correct! (Level ${puzzleState.level})</strong><br>
                    Time: ${a.toFixed(1)}s<br>
                    Wins at this level: ${puzzleState.winsThisLevel}/${GAME_CONFIG.winsNeededForLevelUp}<br>
                    Points: +${n}
                </div>
            `,t.className="puzzle-feedback feedback-correct"),playSound("win"),showConfetti(),(a=document.getElementById("submit-guess"))&&(a.disabled=!0),trackEvent("puzzle_solved","number_puzzle",puzzleState.maxAttempts-puzzleState.attemptsLeft),checkForUnlocks(),puzzleState.winsThisLevel>=GAME_CONFIG.winsNeededForLevelUp?(puzzleState.level++,puzzleState.winsThisLevel=0,setTimeout(()=>{t.innerHTML+=`<br><br>Advancing to Level ${puzzleState.level} (1-${GAME_CONFIG.baseRange+(puzzleState.level-1)*GAME_CONFIG.rangeIncrement})!`,showConfetti({particleCount:200,spread:100}),setTimeout(startNewPuzzle,3e3)},1500)):setTimeout(startNewPuzzle,3e3)):puzzleState.attemptsLeft<=0?(puzzleState.timerEnd=Date.now(),clearInterval(puzzleState.timerInterval),puzzleState.timerInterval=null,puzzleState.winsThisLevel=0,t&&(t.innerHTML=`
                <div class="feedback-message">
                    <strong>Game Over!</strong><br>
                    The number was ${puzzleState.targetNumber}<br>
                    Level: ${puzzleState.level} (1-${puzzleState.maxRange})
                </div>
            `,t.className="puzzle-feedback feedback-wrong",playSound("error")),(n=document.getElementById("submit-guess"))&&(n.disabled=!0),trackEvent("puzzle_failed","number_puzzle",puzzleState.targetNumber),setTimeout(startNewPuzzle,3e3)):puzzleState.blindMode?t&&(t.textContent="Guess submitted (Blind Mode)",t.className="puzzle-feedback",playSound("select")):l<puzzleState.targetNumber?(puzzleState.minRange=l+1,t&&(t.textContent="Too low! Try a higher number.",t.className="puzzle-feedback feedback-low",playSound("error"))):(puzzleState.maxRange=l-1,t&&(t.textContent="Too high! Try a lower number.",t.className="puzzle-feedback feedback-high",playSound("error"))),updatePuzzleUI(),e&&(e.value=""))}function checkForUnlocks(){var e;3<=puzzleState.level&&!puzzleState.unlockedFeatures.extraHints&&(puzzleState.unlockedFeatures.extraHints=!0,(e=document.getElementById("puzzle-feedback"))&&(e.innerHTML+="<br><br>âœ¨ Unlocked: Extra Hints! (3 per game now)"),trackEvent("feature_unlock","game","extra_hints")),5<=puzzleState.level&&!puzzleState.unlockedFeatures.doublePoints&&(puzzleState.unlockedFeatures.doublePoints=!0,(e=document.getElementById("puzzle-feedback"))&&(e.innerHTML+="<br><br>âœ¨ Unlocked: Double Points!"),trackEvent("feature_unlock","game","double_points")),7<=puzzleState.level&&!puzzleState.unlockedFeatures.timeBonus&&(puzzleState.unlockedFeatures.timeBonus=!0,(e=document.getElementById("puzzle-feedback"))&&(e.innerHTML+="<br><br>âœ¨ Unlocked: Time Bonus! (50% more points for fast solves)"),trackEvent("feature_unlock","game","time_bonus"))}function giveHint(){if(puzzleState.hintsUsed>=puzzleState.maxHints){let e=document.getElementById("puzzle-feedback");void(e&&(e.textContent="You have used all your hints!",e.className="puzzle-feedback feedback-wrong",playSound("error")))}else{puzzleState.hintsUsed++;var t=Math.floor((puzzleState.maxRange-puzzleState.minRange)/4),t=`The number is between ${Math.max(puzzleState.minRange,puzzleState.targetNumber-t)} 
                 and `+Math.min(puzzleState.maxRange,puzzleState.targetNumber+t);let e=document.getElementById("puzzle-feedback");e&&(e.textContent=t,e.className="puzzle-feedback",playSound("select")),updatePuzzleUI(),trackEvent("puzzle_hint","number_puzzle",puzzleState.hintsUsed)}}function updatePuzzleUI(){var e=document.getElementById("puzzle-attempts"),t=document.getElementById("puzzle-hint");let l=document.getElementById("guess-history");var a=document.getElementById("puzzle-hint-btn"),n=document.getElementById("current-level"),u=document.getElementById("current-points"),z=document.getElementById("number-guess");e&&(e.textContent=`Attempts left: ${puzzleState.attemptsLeft}/`+puzzleState.maxAttempts),t&&(t.textContent=`Level ${puzzleState.level}: Between ${puzzleState.minRange}-`+puzzleState.maxRange),l&&(l.innerHTML="",puzzleState.guesses.forEach(e=>{var t=e<puzzleState.targetNumber?"â†‘":e>puzzleState.targetNumber?"â†“":"âœ“",a=e===puzzleState.targetNumber?"correct":e<puzzleState.targetNumber?"low":"high",n=document.createElement("div");n.className="guess-entry "+a,n.innerHTML=`
                <span>${e}</span>
                <span>${t}</span>
            `,l.appendChild(n)})),a&&(a.textContent=`Get Hint (${puzzleState.maxHints-puzzleState.hintsUsed} left)`,a.disabled=puzzleState.hintsUsed>=puzzleState.maxHints),n&&(n.textContent="Level: "+puzzleState.level),u&&(u.textContent="Points: "+puzzleState.points),z&&(z.min=puzzleState.minRange,z.max=puzzleState.maxRange,z.placeholder=`Guess (${puzzleState.minRange}-${puzzleState.maxRange})`)}function setupPuzzleEvents(){var e=document.getElementById("submit-guess"),t=document.getElementById("new-puzzle"),a=document.getElementById("puzzle-hint-btn"),n=document.getElementById("number-guess"),l=document.getElementById("mute-btn");let u=document.querySelector("#mute-btn .material-icons");e&&e.addEventListener("click",handleGuessSubmit),t&&t.addEventListener("click",startNewPuzzle),a&&a.addEventListener("click",giveHint),n&&n.addEventListener("keypress",e=>{"Enter"===e.key&&handleGuessSubmit()}),l&&l.addEventListener("click",()=>{puzzleState.isMuted=!puzzleState.isMuted,localStorage.setItem("triviaMasterMuteState",puzzleState.isMuted),u&&(u.textContent=puzzleState.isMuted?"volume_off":"volume_up"),puzzleState.isMuted&&stopAllSounds()})}function initPuzzle(){setupPuzzleEvents(),startNewPuzzle();var e=document.querySelector("#mute-btn .material-icons");e&&(e.textContent=puzzleState.isMuted?"volume_off":"volume_up"),puzzleState.isMuted&&stopAllSounds()}export{initPuzzle};
