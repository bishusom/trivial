function initWordGame(){var e=(()=>{var e=localStorage.getItem("boggleGameState");if(e)try{var t=JSON.parse(e);if(["easy","medium","hard"].includes(t.difficulty)&&"number"==typeof t.consecutiveWins&&"number"==typeof t.currentLevel)return t}catch(e){console.error("Invalid saved game state",e)}return null})();let s=e?.difficulty||"easy",c=e?.consecutiveWins||0,d=e?.currentLevel||1,u=0,n=180,g=null,m={gridSize:{easy:4,medium:5,hard:5},minWordLength:3,maxWordLength:8,timeLimit:180,scorePerLetter:10,winThreshold:{easy:50,medium:100,hard:150},vowelPercentage:{easy:.4,medium:.35,hard:.3}},h=["CAT","DOG","HAT","RUN","SUN","PEN","RED","BLUE","TREE","BIRD","FISH","STAR","MOON","PLAY","BOOK","FOOD","GOOD","LOVE","HOME","TIME","BALL","GAME","CARS","SHIP","WIND","RAIN","SNOW","FIRE","WAVE","HILL"].map(e=>e.toUpperCase()),f=[],v=new Set,p=[],r=!1,L=new Set,E=new Map,a=0,o=document.getElementById("boggle-grid"),y=document.getElementById("boggle-word-list"),l=document.getElementById("boggle-feedback");var e=document.getElementById("boggle-new"),t=document.getElementById("boggle-submit");let i=document.getElementById("boggle-time"),P=document.getElementById("boggle-score"),G=document.getElementById("boggle-level");function w(e,t,n,o){"undefined"!=typeof gtag&&gtag("event",e,{event_category:t,event_label:n,value:o})}async function b(){console.log("Initializing Boggle game with state:",{difficulty:s,currentLevel:d,consecutiveWins:c}),clearInterval(g),n=m.timeLimit,u=0,v.clear(),p=[],r=!1,L.clear(),E.clear(),o.innerHTML="",W(y.innerHTML="","info"),M(),$(),C(),clearInterval(g),g=setInterval(()=>{n--,C()},1e3);try{{let e=m.gridSize[s],t="AEIOU",n=Math.ceil(e*e*m.vowelPercentage[s]),o=0,r=(f=[],[]);h.forEach(e=>{e.split("").forEach(e=>r.push(e))});for(let e=0;e<50;e++)r.push(t[Math.floor(Math.random()*t.length)]);var a="BCDFGHJKLMNPQRSTVWXYZ";for(let e=0;e<25;e++)r.push(a[Math.floor(Math.random()*a.length)]);for(;f.length<e*e;){var l=Math.floor(Math.random()*r.length),l=r[l];o<n&&t.includes(l)?(f.push({letter:l,element:null}),o++):o>=n&&f.push({letter:l,element:null})}var i=f.filter(e=>t.includes(e.letter)).length;console.log(`Generated ${e}x${e} grid with ${i} vowels`),f}e=m.gridSize[s],o.style.gridTemplateColumns=`repeat(${e}, 1fr)`,o.style.gridTemplateRows=`repeat(${e}, 1fr)`,o.style.setProperty("--grid-size",e),o.style.display="grid",o.style.width="100%",o.style.maxWidth="100%",o.style.overflow="hidden",f.forEach((e,t)=>{var n=document.createElement("div");n.className="boggle-cell",n.textContent=e.letter,n.dataset.index=t,n.addEventListener("mousedown",T),n.addEventListener("mouseenter",D),n.addEventListener("mouseup",O),n.addEventListener("touchstart",z,{passive:!1}),n.addEventListener("touchmove",H,{passive:!1}),n.addEventListener("touchend",R),o.appendChild(n),e.element=n}),w("boggle_game_started","boggle","start",1)}catch(e){console.error("Game initialization failed:",e),W("Failed to load puzzle. Please refresh the page.","error")}var e}async function S(){if(p.length<m.minWordLength)W("Word too short","error");else{var t,n,o,r=p.map(e=>f[e].letter).join("");if(v.has(r))W("Word already found","error");else try{let e=!1;E.has(r.toLowerCase())?e=E.get(r.toLowerCase()):(o=await fetch("https://api.dictionaryapi.dev/api/v2/entries/en/"+r.toLowerCase()),e=o.ok,E.set(r.toLowerCase(),e)),e&&r.length>=m.minWordLength&&r.length<=m.maxWordLength?(v.add(r),t=r.length*m.scorePerLetter,u+=t,p.forEach(e=>f[e].element.classList.add("found")),I(),M(),W(`Found: ${r} (+${t} points)`,"success"),w("word_found","boggle",r,t),u>=m.winThreshold[s]&&(clearInterval(g),3<=++c?("easy"===s?(s="medium",W("Advanced to Medium level!","success")):"medium"===s?(s="hard",W("Advanced to Hard level!","success")):W("Mastered all levels!","success"),c=0,d++):W(`Great job! ${3-c} more wins to advance.`,"info"),n={difficulty:s,consecutiveWins:c,currentLevel:d},localStorage.setItem("boggleGameState",JSON.stringify(n)),$(),setTimeout(b,2e3))):W("Not a valid word","error")}catch(e){console.error("Error checking word:",e),h.includes(r.toUpperCase())?(v.add(r),o=r.length*m.scorePerLetter,u+=o,p.forEach(e=>f[e].element.classList.add("found")),I(),M(),W(`Found: ${r} (+${o} points)`,"success"),w("word_found","boggle",r,o)):W("Error checking word, try another","error")}}p=[],A()}function I(){y.innerHTML="",Array.from(v).sort().forEach(e=>{var t=document.createElement("li");t.textContent=e,y.appendChild(t)})}function M(){P.textContent="Score: "+u}function $(){G.textContent=`Level: ${d} (${s})`}function C(){var e=Math.floor(n/60),t=n%60;i.textContent=`Time: ${e}:`+t.toString().padStart(2,"0"),n<=0&&(clearInterval(g),W("Timeâ€™s up!","error"),setTimeout(b,2e3))}function W(e,t){l.textContent=e,l.className="word-feedback "+t}function T(e){e.preventDefault(),r=!0;e=B(e.target);null!==e&&(p=[e],L=new Set([e]),A(),x(e),console.log(`Selection started at index ${e} (${f[e].letter}) at (${Math.floor(e/5)}, ${e%5})`))}function D(e){var t,n,o;e.preventDefault(),!r||0===p.length||(t=Date.now())-a<20||(a=t,null===(t=B(e.target)))||L.has(t)||(e=p[p.length-1],n=m.gridSize[s],console.log(`Checking adjacency between: 
      ${e} (${f[e].letter}) at (${Math.floor(e/n)},${e%n}) and 
      ${t} (${f[t].letter}) at (${Math.floor(t/n)},${t%n})`),n=t,e=N(e=e),n=N(n),o=Math.abs(n.row-e.row),n=Math.abs(n.col-e.col),o<=1&&n<=1&&(0!==o||0!==n)?(p.push(t),L.add(t),A(),x(t)):console.log("Not adjacent - row/col diff too large"))}function O(){r&&(r=!1,f.forEach(e=>e.element.classList.remove("adjacent")),console.log("Selection ended, word: "+p.map(e=>f[e].letter).join("")),(p.length<2?(W("Selection too short, please select at least 2 letters","error"),p=[],A):S)())}function x(e){f.forEach(e=>e.element.classList.remove("adjacent"));var n,o=m.gridSize[s],r=Math.floor(e/o),a=e%o;for(let t=r-1;t<=r+1;t++)for(let e=a-1;e<=1+a;e++)t===r&&e===a||t<0||t>=o||e<0||e>=o||(n=t*o+e,L.has(n))||f[n].element.classList.add("adjacent")}function B(e){return e.classList.contains("boggle-cell")?parseInt(e.dataset.index):null}function N(e){var t=m.gridSize[s];return{row:Math.floor(e/t),col:e%t}}function A(){f.forEach(e=>e.element.classList.remove("selected")),p.forEach(e=>{f[e].element&&f[e].element.classList.add("selected")})}function z(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("boggle-cell")&&T({target:e,preventDefault:()=>{}})}function H(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("boggle-cell")&&D({target:e,preventDefault:()=>{}})}function R(e){e.preventDefault(),O()}b(),e.addEventListener("click",b),t.addEventListener("click",S)}document.addEventListener("DOMContentLoaded",()=>{initWordGame()});export{initWordGame};
