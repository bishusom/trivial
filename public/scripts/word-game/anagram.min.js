function initWordGame(){console.log("Initializing Anagram game");let o="",i=[],l=[],d=[],c=0,m=[],s=null,n=0,u=null,e=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,g=1,f=[{difficulty:"easy",wordLength:[6,7],games:3,timeLimit:240},{difficulty:"medium",wordLength:[8,9],games:3,timeLimit:300},{difficulty:"hard",wordLength:[10,11,12],games:3,timeLimit:500}],r=0,t=f.reduce((e,t)=>e+t.games,0),h=document.getElementById("scrambled-letters"),a=document.getElementById("current-attempt");var U=document.getElementById("anagram-submit"),H=document.getElementById("anagram-clear"),W=document.getElementById("anagram-shuffle"),_=document.getElementById("anagram-new"),P=document.getElementById("anagram-hint"),D=document.getElementById("anagram-reveal");let p=document.getElementById("anagram-feedback"),v=document.getElementById("anagram-target"),y=document.getElementById("anagram-score"),E=document.getElementById("solutions-list"),w=document.getElementById("anagram-level"),j=document.getElementById("anagram-games-remaining"),q=document.getElementById("anagram-time")||((I=document.createElement("span")).id="anagram-time",I.className="word-game-timer",document.querySelector(".game-meta").appendChild(I),I);var I=document.getElementById("mute-btn");let C=document.querySelector("#mute-btn .material-icons"),x={select:new Audio("/audio/click.mp3"),found:new Audio("/audio/correct.mp3"),win:new Audio("/audio/win.mp3"),error:new Audio("/audio/wrong.mp3")};function L(t){e?console.log(`Sound ${t} skipped: muted`):(console.log("Playing sound: "+t),x[t]&&(x[t].currentTime=0,x[t].play().catch(e=>console.error(`Error playing ${t} sound:`,e))))}function M(){Object.keys(x).forEach(e=>{e=e,x[e]&&(x[e].pause(),x[e].currentTime=0)})}function S(){clearInterval(u);var e=f.find(e=>g<=e.games+f.slice(0,f.indexOf(e)).reduce((e,t)=>e+t.games,0));n=e.timeLimit,T(),u=setInterval(()=>{n--,T(),n<=0&&(clearInterval(u),O("Time's up!","error"),setTimeout(R,2e3))},1e3)}function T(){var e=Math.floor(n/60),t=n%60;q.textContent=`Time: ${e}:`+t.toString().padStart(2,"0")}function N(e={}){let t={particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]};confetti({...t,...e}),.5<Math.random()&&setTimeout(()=>{confetti({...t,...e,angle:180*Math.random()-90,origin:{x:Math.random(),y:.6}})},300)}function b(e){return e.split("").sort(()=>Math.random()-.5).join("")}async function B(){try{s&&(clearTimeout(s),s=null);var e=f.find(e=>g<=e.games+f.slice(0,f.indexOf(e)).reduce((e,t)=>e+t.games,0)),r=e.wordLength[Math.floor(Math.random()*e.wordLength.length)],n=Math.floor(9e5*Math.random()),a=await db.collection("dictionary").where("length","==",r).where("isCommon","==",!0).where("randomIndex",">=",n).orderBy("randomIndex").limit(50).get();let t=[];if(a.forEach(e=>{e=e.data().word.toUpperCase();m.includes(e)||t.push(e)}),0===t.length)throw new Error("No unused words found in database");o=t[Math.floor(Math.random()*t.length)],m.push(o),i=b(o).split(""),d=[],l=[],k(),$(),A(),v.textContent="Word Length: "+o.length,y.textContent="Score: "+c,w.textContent=`Level: ${g} (${e.difficulty})`,J(),p.textContent="Unscramble the letters to form the correct word!",p.className="anagram-feedback info",S()}catch(e){console.error("Error initializing game:",e);r=["PICTURE","SILENCE","CAPTURE","MOUNTAIN","ADVENTURE","DISCOVERY","STANDARD","PARADISE"].filter(e=>!m.includes(e));let t=f.find(e=>g<=e.games+f.slice(0,f.indexOf(e)).reduce((e,t)=>e+t.games,0)),n=t.wordLength[Math.floor(Math.random()*t.wordLength.length)],a=r.filter(e=>e.length===n);0===a.length&&(console.warn("No unused words available in fallback list. Resetting used words."),m=[],0===(a=r.filter(e=>e.length===n)).length)&&0===(a=r.filter(e=>t.wordLength.includes(e.length))).length&&(a=["PICTURE"]),o=a[Math.floor(Math.random()*a.length)],m.push(o),i=b(o).split(""),d=[],l=[],k(),$(),A(),v.textContent="Word Length: "+o.length,y.textContent="Score: "+c,w.textContent=`Level: ${g} (${t.difficulty})`,J(),p.textContent="Unscramble the letters to form the correct word!",p.className="anagram-feedback info",S()}"undefined"!=typeof gtag&&gtag("event","anagram_started",{event_category:"anagram",event_label:1,value:void 0})}function k(){h.innerHTML="",i.forEach((e,t)=>{var n=document.createElement("div");n.className="letter-tile "+(l.includes(t)?"used":""),n.textContent=e,n.dataset.index=t,n.addEventListener("click",()=>{var e;e=t,l.includes(e)||(l.push(e),L("select"),$(),k())}),h.appendChild(n)})}function $(){a.innerHTML="",l.forEach(e=>{var t=document.createElement("span");t.textContent=i[e],a.appendChild(t)})}function Y(e){return 5*e.length}function G(){l=[],$(),k()}function A(){var e;E.innerHTML="",d.includes(o)&&((e=document.createElement("div")).className="solution-word",e.textContent=o,E.appendChild(e))}function O(e,t){p.textContent=e,p.className="anagram-feedback "+t}function J(){var e=f.findIndex(e=>g<=e.games+f.slice(0,f.indexOf(e)).reduce((e,t)=>e+t.games,0)),e=f.slice(0,e).reduce((e,t)=>e+t.games,0)+r,e=t-e;j.textContent="Games to Win: "+e}function R(){r++;var e=f.find(e=>g<=e.games+f.slice(0,f.indexOf(e)).reduce((e,t)=>e+t.games,0));if(r>=e.games&&(g++,r=0,g<=t)&&N({particleCount:200,spread:100}),g>t){let e=document.createElement("div"),t=(e.className="victory-screen",N({particleCount:200,spread:100}),L("win"),e.innerHTML=`
                <h2>Congratulations!</h2>
                <p>You've won the game!</p>
                <p>Final Score: ${c}</p>
                <div class="countdown">Restarting in 5...</div>
            `,document.body.appendChild(e),5),n=e.querySelector(".countdown"),a=setInterval(()=>{t--,n.textContent=`Restarting in ${t}...`,t<=0&&(clearInterval(a),e.remove(),g=1,r=0,m=[],c=0,B())},1e3)}else B()}U.addEventListener("click",function(){if(0===l.length)O("Please select some letters first","error"),L("error");else{var r=l.map(e=>i[e]).join("");if(r.length!==o.length)O(`Word must be ${o.length} letters`,"error"),L("error");else if(r===o){d.push(r),c+=Y(r),O(`Correct! You found the word! +${Y(r)} points`,"success"),L("found"),h.innerHTML="",A(),y.textContent="Score: "+c,G(),clearInterval(u);let e=document.createElement("div");e.className="victory-screen",N(),e.innerHTML=`
                <h2>Victory!</h2>
                <p>${`ðŸŽ‰ Word Found: ${r}! ðŸŽ‰`}</p>
                <p>Score: ${c}</p>
                <div class="countdown">Next game starting in 5...</div>
            `,document.body.appendChild(e);let t=5,n=e.querySelector(".countdown"),a=setInterval(()=>{t--,n.textContent=`Next game starting in ${t}...`,t<=0&&(clearInterval(a),e.remove(),R())},1e3);s&&(clearTimeout(s),s=null)}else O("Not the correct word","error"),L("error")}}),H.addEventListener("click",G),W.addEventListener("click",function(){i=b(o).split(""),k()}),_.addEventListener("click",B),P.addEventListener("click",function(){d.includes(o)?O("You already found the word!","info"):O(`Try starting with: ${o.split("").slice(0,2).join("")}...`,"info")}),D.addEventListener("click",function(){O("The word was: "+o,"info"),h.innerHTML="",clearInterval(u),s&&clearTimeout(s),s=setTimeout(()=>{R(),s=null},2500)}),I&&I.addEventListener("click",()=>{e=!e,localStorage.setItem("triviaMasterMuteState",JSON.stringify(e)),C&&(C.textContent=e?"volume_off":"volume_up"),e&&M()}),e=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,C&&(C.textContent=e?"volume_off":"volume_up"),e&&M(),B()}export{initWordGame};
