function initWordGame(){var e=(()=>{var e=localStorage.getItem("boggleGameState");if(e)try{var t=JSON.parse(e);if(["easy","medium","hard"].includes(t.difficulty)&&"number"==typeof t.consecutiveWins&&"number"==typeof t.currentLevel)return t}catch(e){console.error("Invalid saved game state",e)}return null})();let s=e?.difficulty||"easy",c=e?.consecutiveWins||0,d=e?.currentLevel||1,u=0,n=180,g=null,m={gridSize:{easy:4,medium:5,hard:5},minWordLength:3,maxWordLength:8,timeLimit:180,scorePerLetter:10,winThreshold:{easy:50,medium:100,hard:150},vowelPercentage:{easy:.4,medium:.35,hard:.3}},h=["CAT","DOG","HAT","RUN","SUN","PEN","RED","BLUE","TREE","BIRD","FISH","STAR","MOON","PLAY","BOOK","FOOD","GOOD","LOVE","HOME","TIME","BALL","GAME","CARS","SHIP","WIND","RAIN","SNOW","FIRE","WAVE","HILL"].map(e=>e.toUpperCase()),f=[],v=new Set,p=[],r=!1,y=new Set,L=new Map,l=0,E=document.getElementById("boggle-grid"),o=document.getElementById("boggle-word-list"),a=document.getElementById("boggle-feedback");var e=document.getElementById("boggle-new"),t=document.getElementById("boggle-submit");let A=document.getElementById("boggle-time"),G=document.getElementById("boggle-score"),R=document.getElementById("boggle-level");function w(e,t,n,o){"undefined"!=typeof gtag&&gtag("event",e,{event_category:t,event_label:n,value:o})}async function i(){console.log("Initializing Boggle game with state:",{difficulty:s,currentLevel:d,consecutiveWins:c});var e,t=document.querySelector(".selection-line");t&&t.remove(),clearInterval(g),n=m.timeLimit,u=0,v.clear(),p=[],r=!1,y.clear(),L.clear(),E.innerHTML="",x(o.innerHTML="","info"),I(),$(),C(),clearInterval(g),g=setInterval(()=>{n--,C()},1e3);try{{let e=m.gridSize[s],t="AEIOU",n=Math.ceil(e*e*m.vowelPercentage[s]),o=0,r=(f=[],[]);h.forEach(e=>{e.split("").forEach(e=>r.push(e))});for(let e=0;e<50;e++)r.push(t[Math.floor(Math.random()*t.length)]);var l="BCDFGHJKLMNPQRSTVWXYZ";for(let e=0;e<25;e++)r.push(l[Math.floor(Math.random()*l.length)]);for(;f.length<e*e;){var a=Math.floor(Math.random()*r.length),a=r[a];o<n&&t.includes(a)?(f.push({letter:a,element:null}),o++):o>=n&&f.push({letter:a,element:null})}var i=f.filter(e=>t.includes(e.letter)).length;console.log(`Generated ${e}x${e} grid with ${i} vowels`),f}e=m.gridSize[s],E.style.gridTemplateColumns=`repeat(${e}, 1fr)`,E.style.gridTemplateRows=`repeat(${e}, 1fr)`,E.style.setProperty("--grid-size",e),E.style.display="grid",E.style.width="100%",E.style.maxWidth="100%",E.style.overflow="hidden",f.forEach((e,t)=>{var n=document.createElement("div");n.className="boggle-cell",n.textContent=e.letter,n.dataset.index=t,n.addEventListener("mousedown",W),n.addEventListener("mouseenter",T),n.addEventListener("mouseup",B),n.addEventListener("touchstart",z,{passive:!1}),n.addEventListener("touchmove",H,{passive:!1}),n.addEventListener("touchend",F),E.appendChild(n),e.element=n}),w("boggle_game_started","boggle","start",1)}catch(e){console.error("Game initialization failed:",e),x("Failed to load puzzle. Please refresh the page.","error")}}function M(e){var e=f[e].element.getBoundingClientRect(),t=E.getBoundingClientRect();return{x:e.left+e.width/2-t.left,y:e.top+e.height/2-t.top}}async function S(){if(p.length<m.minWordLength)x("Word too short","error");else{var t,n,o,r=p.map(e=>f[e].letter).join("");if(v.has(r))x("Word already found","error");else try{let e=!1;L.has(r.toLowerCase())?e=L.get(r.toLowerCase()):(o=await fetch("https://api.dictionaryapi.dev/api/v2/entries/en/"+r.toLowerCase()),e=o.ok,L.set(r.toLowerCase(),e)),e&&r.length>=m.minWordLength&&r.length<=m.maxWordLength?(v.add(r),t=r.length*m.scorePerLetter,u+=t,p.forEach(e=>f[e].element.classList.add("found")),b(),I(),x(`Found: ${r} (+${t} points)`,"success"),w("word_found","boggle",r,t),u>=m.winThreshold[s]&&(clearInterval(g),3<=++c?("easy"===s?(s="medium",x("Advanced to Medium level!","success")):"medium"===s?(s="hard",x("Advanced to Hard level!","success")):x("Mastered all levels!","success"),c=0,d++):x(`Great job! ${3-c} more wins to advance.`,"info"),n={difficulty:s,consecutiveWins:c,currentLevel:d},localStorage.setItem("boggleGameState",JSON.stringify(n)),$(),setTimeout(i,2e3))):x("Not a valid word","error")}catch(e){console.error("Error checking word:",e),h.includes(r.toUpperCase())?(v.add(r),o=r.length*m.scorePerLetter,u+=o,p.forEach(e=>f[e].element.classList.add("found")),b(),I(),x(`Found: ${r} (+${o} points)`,"success"),w("word_found","boggle",r,o)):x("Error checking word, try another","error")}}p=[],P()}function b(){o.innerHTML="",Array.from(v).sort().forEach(e=>{var t=document.createElement("li");t.textContent=e,o.appendChild(t)})}function I(){G.textContent="Score: "+u}function $(){R.textContent=`Level: ${d} (${s})`}function C(){var e=Math.floor(n/60),t=n%60;A.textContent=`Time: ${e}:`+t.toString().padStart(2,"0"),n<=0&&(clearInterval(g),x("Timeâ€™s up!","error"),setTimeout(i,2e3))}function x(e,t){a.textContent=e,a.className="word-feedback "+t}function W(e){e.preventDefault(),r=!0;e=N(e.target);null!==e&&(p=[e],y=new Set([e]),P(),D(e),console.log(`Selection started at index ${e} (${f[e].letter}) at (${Math.floor(e/5)}, ${e%5})`))}function T(e){var t,n,o;e.preventDefault(),!r||0===p.length||(t=Date.now())-l<20||(l=t,null===(t=N(e.target)))||y.has(t)||(e=p[p.length-1],n=m.gridSize[s],console.log(`Checking adjacency between: 
      ${e} (${f[e].letter}) at (${Math.floor(e/n)},${e%n}) and 
      ${t} (${f[t].letter}) at (${Math.floor(t/n)},${t%n})`),n=t,e=O(e=e),n=O(n),o=Math.abs(n.row-e.row),n=Math.abs(n.col-e.col),o<=1&&n<=1&&(0!==o||0!==n)?(p.push(t),y.add(t),P(),D(t)):console.log("Not adjacent - row/col diff too large"))}function B(){var e;r&&(r=!1,f.forEach(e=>e.element.classList.remove("adjacent")),(e=document.querySelector(".selection-line"))&&e.remove(),(p.length<2?(x("Selection too short, please select at least 2 letters","error"),p=[],P):S)())}function D(e){f.forEach(e=>e.element.classList.remove("adjacent"));var n,o=m.gridSize[s],r=Math.floor(e/o),l=e%o;for(let t=r-1;t<=r+1;t++)for(let e=l-1;e<=1+l;e++)t===r&&e===l||t<0||t>=o||e<0||e>=o||(n=t*o+e,y.has(n))||f[n].element.classList.add("adjacent")}function N(e){return e.classList.contains("boggle-cell")?parseInt(e.dataset.index):null}function O(e){var t=m.gridSize[s];return{row:Math.floor(e/t),col:e%t}}function P(){f.forEach(e=>{e.element.classList.remove("selected","highlight")}),p.forEach(e=>{f[e].element&&(f[e].element.classList.add("selected"),e===p[p.length-1])&&f[e].element.classList.add("highlight")});var e=document.querySelector(".selection-line");if(e&&e.remove(),!(p.length<2)){e=document.createElement("div");e.className="selection-line",E.appendChild(e);for(let e=0;e<p.length-1;e++){var t=M(p[e]),n=M(p[e+1]),o=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2)),n=180*Math.atan2(n.y-t.y,n.x-t.x)/Math.PI,r=document.createElement("div");r.className="selection-line",r.style.width=o+"px",r.style.left=t.x+"px",r.style.top=t.y+"px",r.style.transform=`rotate(${n}deg)`,E.appendChild(r)}}}function z(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("boggle-cell")&&W({target:e,preventDefault:()=>{}})}function H(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("boggle-cell")&&T({target:e,preventDefault:()=>{}})}function F(e){e.preventDefault(),B()}i(),e.addEventListener("click",i),t.addEventListener("click",S)}document.addEventListener("DOMContentLoaded",()=>{initWordGame()});export{initWordGame};
