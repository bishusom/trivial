function initWordGame(){console.log("Initializing Anagram game");let o="",d=[],i=[],l=[],c=0,s=[],m=null,u=1,g=[{difficulty:"easy",wordLength:[6,7],games:3},{difficulty:"medium",wordLength:[8,9],games:3},{difficulty:"hard",wordLength:[10,11,12],games:3}],t=0,n=g.reduce((e,t)=>e+t.games,0),a=document.getElementById("scrambled-letters"),r=document.getElementById("current-attempt");var e=document.getElementById("anagram-submit"),f=document.getElementById("anagram-clear"),h=document.getElementById("anagram-shuffle"),E=document.getElementById("anagram-new"),v=document.getElementById("anagram-hint"),y=document.getElementById("anagram-reveal");let w=document.getElementById("anagram-feedback"),C=document.getElementById("anagram-target"),p=document.getElementById("anagram-score"),I=document.getElementById("solutions-list"),x=document.getElementById("anagram-level"),L=document.getElementById("anagram-games-remaining");function T(e){return e.split("").sort(()=>Math.random()-.5).join("")}async function M(){try{m&&(clearTimeout(m),m=null);var e=g.find(e=>u<=e.games+g.slice(0,g.indexOf(e)).reduce((e,t)=>e+t.games,0)),r=e.wordLength[Math.floor(2*Math.random())],n=Math.floor(9e5*Math.random()),a=await db.collection("dictionary").where("length","==",r).where("isCommon","==",!0).where("randomIndex",">=",n).orderBy("randomIndex").limit(50).get();let t=[];if(a.forEach(e=>{e=e.data().word.toUpperCase();s.includes(e)||t.push(e)}),0===t.length)throw new Error("No unused words found in database");o=t[Math.floor(Math.random()*t.length)],s.push(o),d=T(o).split(""),l=[],i=[],B(),N(),A(),C.textContent="Word Length: "+o.length,p.textContent="Score: "+c,x.textContent=`Level: ${u} (${e.difficulty})`,S(),w.textContent="",w.className="anagram-feedback"}catch(e){console.error("Error initializing game:",e);r=["PICTURE","SILENCE","CAPTURE","MOUNTAIN","ADVENTURE","DISCOVERY","STANDARD","PARADISE"].filter(e=>!s.includes(e));let t=g.find(e=>u<=e.games+g.slice(0,g.indexOf(e)).reduce((e,t)=>e+t.games,0)),n=t.wordLength[Math.floor(2*Math.random())],a=r.filter(e=>e.length===n);0===a.length&&(console.warn("No unused words available in fallback list. Resetting used words."),s=[],0===(a=r.filter(e=>e.length===n)).length)&&0===(a=r.filter(e=>t.wordLength.includes(e.length))).length&&(a=["PICTURE"]),o=a[Math.floor(Math.random()*a.length)],s.push(o),d=T(o).split(""),l=[],i=[],B(),N(),A(),C.textContent="Word Length: "+o.length,p.textContent="Score: "+c,x.textContent=`Level: ${u} (${t.difficulty})`,S(),w.textContent="",w.className="anagram-feedback"}"undefined"!=typeof gtag&&gtag("event","anagram_started",{event_category:"anagram",event_label:1,value:void 0})}function B(){a.innerHTML="",d.forEach((e,t)=>{var n=document.createElement("div");n.className="letter-tile "+(i.includes(t)?"used":""),n.textContent=e,n.dataset.index=t,n.addEventListener("click",()=>{var e;e=t,i.includes(e)||(i.push(e),N(),B())}),a.appendChild(n)})}function N(){r.innerHTML="",i.forEach(e=>{var t=document.createElement("span");t.textContent=d[e],r.appendChild(t)})}function b(e){return 5*e.length}function k(){i=[],N(),B()}function A(){var e;I.innerHTML="",l.includes(o)&&((e=document.createElement("div")).className="solution-word",e.textContent=o,I.appendChild(e))}function R(e,t){w.textContent=t,w.className="anagram-feedback "+e}function S(){var e=g.findIndex(e=>u<=e.games+g.slice(0,g.indexOf(e)).reduce((e,t)=>e+t.games,0)),e=g.slice(0,e).reduce((e,t)=>e+t.games,0)+t,e=n-e;L.textContent="Games to Win: "+e}function $(){t++;var e=g.find(e=>u<=e.games+g.slice(0,g.indexOf(e)).reduce((e,t)=>e+t.games,0));t>=e.games&&(u++,t=0),u>n?(R("success","Congratulations! You won the game!"),setTimeout(()=>{u=1,t=0,s=[],c=0,M()},3e3)):M()}e.addEventListener("click",function(){var e;0===i.length?R("error","Please select some letters first"):(e=i.map(e=>d[e]).join("")).length!==o.length?R("error",`Word must be ${o.length} letters`):e===o?(l.push(e),c+=b(e),R("success",`Correct! You found the word! +${b(e)} points`),a.innerHTML="",A(),p.textContent="Score: "+c,k(),m&&clearTimeout(m),m=setTimeout(()=>{$(),m=null},2500)):R("error","Not the correct word")}),f.addEventListener("click",k),h.addEventListener("click",function(){d=T(o).split(""),B()}),E.addEventListener("click",M),v.addEventListener("click",function(){l.includes(o)?R("info","You already found the word!"):R("info",`Try starting with: ${o.split("").slice(0,2).join("")}...`)}),y.addEventListener("click",function(){R("info","The word was: "+o),a.innerHTML="",m&&clearTimeout(m),m=setTimeout(()=>{$(),m=null},2500)}),M()}export{initWordGame};
