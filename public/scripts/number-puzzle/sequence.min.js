function initPuzzle(){let r={currentSequence:[],correctAnswer:0,level:1,score:0,sequencesSolved:0,timeoutId:null,isMuted:JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,timeLeft:120,timerInterval:null},n={select:new Audio("/audio/click.mp3"),found:new Audio("/audio/correct.mp3"),win:new Audio("/audio/win.mp3"),error:new Audio("/audio/wrong.mp3")},a={sequenceDisplay:document.getElementById("sequence-display"),sequenceOptions:document.getElementById("sequence-options"),sequenceFeedback:document.getElementById("sequence-feedback"),hintText:document.getElementById("hint-text"),sequenceHint:document.getElementById("sequence-hint"),sequenceNext:document.getElementById("sequence-next"),sequenceNew:document.getElementById("sequence-new"),sequenceLevel:document.getElementById("sequence-level"),sequenceScore:document.getElementById("sequence-score"),timeEl:document.getElementById("sequence-time")||(()=>{var e=document.createElement("span"),t=(e.id="sequence-time",e.className="timer-value",document.querySelector(".puzzle-meta"));return t&&t.appendChild(e),e})()};function c(t){r.isMuted?console.log(`Sound ${t} skipped: muted`):n[t]&&(n[t].currentTime=0,n[t].play().catch(e=>console.error(`Error playing ${t} sound:`,e)))}function t(){Object.keys(n).forEach(e=>{e=e,n[e]&&(n[e].pause(),n[e].currentTime=0)})}function l(){console.log("Starting timer"),r.timerInterval&&clearInterval(r.timerInterval),r.timeLeft=120,e(),r.timerInterval=setInterval(()=>{console.log("Timer tick: "+r.timeLeft),r.timeLeft=Math.max(0,r.timeLeft-1),e(),r.timeLeft<=0&&(console.log("Timer expired"),clearInterval(r.timerInterval),r.timerInterval=null,a.sequenceFeedback.textContent="Time's up!",a.sequenceFeedback.className="sequence-feedback wrong",c("error"),setTimeout(q,2e3))},1e3)}function e(){var e,t;a.timeEl?(e=Math.floor(r.timeLeft/60),t=r.timeLeft%60,a.timeEl.textContent=`Time: ${e}:`+t.toString().padStart(2,"0"),a.timeEl.className="timer-value "+(r.timeLeft<=10?"time-critical":"")):console.warn("Timer element not found")}function s(t={}){if(console.log("Triggering confetti"),"undefined"==typeof confetti)console.error("Confetti library not loaded");else{let e={particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]};confetti({...e,...t}),.5<Math.random()&&setTimeout(()=>{confetti({...e,...t,angle:180*Math.random()-90,origin:{x:Math.random(),y:.6}})},300)}}function i(e,t,n,o){"undefined"!=typeof gtag&&gtag("event",e,{event_category:t,event_label:n,value:o})}function o(){r.timeoutId&&(clearTimeout(r.timeoutId),r.timeoutId=null),r.level=1,r.score=0,r.sequencesSolved=0,r.isMuted=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,v(),q(),l(),i("sequence_started","number_sequence",1),r.isMuted&&t();var e=document.querySelector("#mute-btn .material-icons");e&&(e.textContent=r.isMuted?"volume_off":"volume_up")}function u(){var t=Math.floor(10*Math.random())+1,n=Math.floor(6*Math.random())+2,o=Math.floor(3*Math.random())+4,r=[];for(let e=0;e<o;e++)r.push(t+e*n);return{sequence:r.slice(0,-1),answer:r[r.length-1],description:`Arithmetic sequence: add ${n} each time`}}function d(){var t=Math.floor(5*Math.random())+1,n=Math.floor(3*Math.random())+2,o=Math.floor(3*Math.random())+4,r=[];for(let e=0;e<o;e++)r.push(t*Math.pow(n,e));return{sequence:r.slice(0,-1),answer:r[r.length-1],description:`Geometric sequence: multiply by ${n} each time`}}function m(){var t=Math.floor(5*Math.random())+1,n=Math.floor(3*Math.random())+4,o=[];for(let e=0;e<n;e++)o.push(Math.pow(t+e,2));return{sequence:o.slice(0,-1),answer:o[o.length-1],description:"Square numbers: nÂ² where n starts at "+t}}function f(){var e=Math.floor(4*Math.random()),t=Math.floor(3*Math.random())+4,e=[2,3,5,7,11,13,17,19,23,29].slice(e,e+t);return{sequence:e.slice(0,-1),answer:e[e.length-1],description:"Prime number sequence"}}function h(){var e=Math.floor(5*Math.random())+1,t=Math.floor(5*Math.random())+1,n=Math.floor(3*Math.random())+5,o=[e,t];for(let e=2;e<n;e++)o.push(o[e-1]+o[e-2]);return{sequence:o.slice(0,-1),answer:o[o.length-1],description:"Fibonacci-like sequence: each number is the sum of the two preceding ones"}}function M(){var e=[m,f,h];return e[Math.floor(Math.random()*e.length)]()}function q(){a.sequenceDisplay.innerHTML="",a.sequenceOptions.innerHTML="",a.sequenceFeedback.textContent="",a.hintText.textContent="";let e;var{sequence:t,answer:n,description:o}=[u,d,m,f,h,M][e=r.level<=2?Math.floor(2*Math.random()):r.level<=4?Math.random()<.7?Math.floor(2*Math.random()):2+Math.floor(2*Math.random()):r.level<=6?(t=Math.random())<.5?2+Math.floor(2*Math.random()):t<.8?Math.floor(2*Math.random()):4+Math.floor(2*Math.random()):(t=Math.random())<.6?4+Math.floor(2*Math.random()):t<.9?2+Math.floor(2*Math.random()):Math.floor(2*Math.random())](),t=(r.currentSequence=t,r.correctAnswer=n,t.forEach((e,t)=>{var n=document.createElement("span");n.className="sequence-number",n.textContent=e,a.sequenceDisplay.appendChild(n)}),document.createElement("span"));t.className="sequence-number missing",t.textContent="?",a.sequenceDisplay.appendChild(t),(t=>{for(var n=[t];n.length<4;){let e;switch(Math.floor(3*Math.random())+1){case 1:e=t+Math.floor(5*Math.random())+1;break;case 2:e=t-Math.floor(5*Math.random())+1;break;case 3:e=t*Math.floor(2*Math.random())+1}0<e&&!n.includes(e)&&n.push(e)}return n.sort(()=>Math.random()-.5)})(n).forEach((e,t)=>{var n=document.createElement("button");n.className="btn",n.textContent=e,n.addEventListener("click",()=>{return t=e,c("select"),void(parseInt(t)===r.correctAnswer?(a.sequenceFeedback.textContent="Correct! Well done!",a.sequenceFeedback.className="sequence-feedback correct",r.score+=10*r.level,r.sequencesSolved++,3<=r.sequencesSolved?(r.level++,r.sequencesSolved=0,s({particleCount:150,spread:80})):s(),v(),document.querySelectorAll("#sequence-options button").forEach(e=>{e.disabled=!0,parseInt(e.textContent)===r.correctAnswer&&e.classList.add("correct")}),clearInterval(r.timerInterval),r.timerInterval=null,c("win"),i("sequence_solved","number_sequence",r.level),r.timeoutId=setTimeout(()=>{q(),r.timeoutId=null},2500)):(a.sequenceFeedback.textContent="Incorrect. Try again!",a.sequenceFeedback.className="sequence-feedback wrong",document.querySelectorAll("#sequence-options button").forEach(e=>{e.textContent===t&&e.classList.add("wrong")}),c("error")));var t}),a.sequenceOptions.appendChild(n)}),a.hintText.dataset.description=o,l()}function p(){a.hintText.textContent=a.hintText.dataset.description,c("select")}function v(){a.sequenceLevel.textContent="Level: "+r.level,a.sequenceScore.textContent="Score: "+r.score}o();{a.sequenceHint.addEventListener("click",p),a.sequenceNext.addEventListener("click",()=>{c("select"),r.timeoutId&&(clearTimeout(r.timeoutId),r.timeoutId=null),q()}),a.sequenceNew.addEventListener("click",()=>{c("select"),o()});var g=document.getElementById("mute-btn");let e=document.querySelector("#mute-btn .material-icons");g&&g.addEventListener("click",()=>{r.isMuted=!r.isMuted,localStorage.setItem("triviaMasterMuteState",r.isMuted),e&&(e.textContent=r.isMuted?"volume_off":"volume_up"),r.isMuted&&t(),c("select")})}}export{initPuzzle};
