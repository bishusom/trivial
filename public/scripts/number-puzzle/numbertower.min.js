function initPuzzle(){let s=document.getElementById("tower-grid"),m=document.getElementById("tower-stack"),i=document.getElementById("tower-feedback");var e=document.getElementById("tower-hint"),t=document.getElementById("tower-clear"),n=document.getElementById("tower-new");let r=document.getElementById("tower-level"),a=document.getElementById("tower-score"),l=document.getElementById("tower-time"),c=document.getElementById("tower-height"),o=document.getElementById("tower-target"),d=document.getElementById("tower-objective"),u=document.getElementById("progress-fill"),h=1,f=0,x=60,g,b=[],v=!1,y="",w=5,M=0,p=null;function C(){clearInterval(g),h=1,f=0,x=60,M=0,k(),E(),I(),L(),v=!0,"undefined"!=typeof gtag&&gtag("event","numbertower_started",{event_category:"number_tower",event_label:1,value:void 0})}function E(){var e,t=[{name:"multiples",text:"Build the tower by selecting multiples of X!",fn:(e,t)=>e%t==0,minX:2,xGenerator:e=>Math.max(2,Math.floor(e/2)+1),numberGenerator:(t,n)=>{var r=[];for(let e=t;e<=n;e+=t)r.push(e);return{numbers:r,x:t}}},{name:"factors",text:"Build the tower by selecting factors of X!",fn:(e,t)=>t%e==0,minX:4,xGenerator:e=>{var t=[4,6,8,9,10,12,14,15,16,18,20];return t[Math.floor(Math.random()*t.length)]},numberGenerator:(t,e)=>{var n=[];for(let e=1;e<=t;e++)t%e==0&&n.push(e);return{numbers:n,x:t}}},{name:"greater",text:"Build the tower by selecting numbers greater than X!",fn:(e,t)=>t<e,minX:1,xGenerator:(e,t)=>Math.max(1,Math.floor(.3*t)),numberGenerator:(n,e)=>({numbers:Array.from({length:e-n},(e,t)=>n+1+t),x:n})},{name:"less",text:"Build the tower by selecting numbers less than X!",fn:(e,t)=>e<t,minX:4,xGenerator:(e,t)=>Math.min(t-2,Math.max(4,Math.floor(.7*t))),numberGenerator:(e,t)=>({numbers:Array.from({length:e-1},(e,t)=>t+1),x:e})},{name:"additive",text:"Build the tower by selecting numbers that are X more than the last!",fn:(e,t,n)=>!n||e===n+t,xGenerator:e=>Math.max(1,Math.floor(e/3)+1),numberGenerator:(e,t)=>({numbers:Array.from({length:t},(e,t)=>t+1),x:e})},{name:"multiplicative",text:"Build the tower by selecting numbers that are X times the last!",fn:(e,t,n)=>!n||e===n*t,xGenerator:e=>Math.max(2,Math.floor(e/3)+2),numberGenerator:(e,t)=>({numbers:Array.from({length:t},(e,t)=>t+1),x:e})}],n=G();let r,a;for(let e=0;e<3;e++){var l=(r=t[Math.floor(Math.random()*t.length)]).xGenerator(h,n);if(4<=(a=r.numberGenerator(l,n)).numbers.length)break}a.numbers.length<4&&(e=(r=t.find(e=>"multiples"===e.name)).Generator(h),a=r.numberGenerator(e,n)),y={text:r.text.replace("X",a.x),fn:(e,t)=>r.fn(e,a.x,t),xValue:a.x,numbers:a.numbers},w=Math.min(4+h,10),o.textContent=w,c.textContent=M,d.textContent=y.text}function I(){s.innerHTML="",m.innerHTML="",b=[],p=null;var e=h<=3?4:h<=6?5:6,t=e*e;let n=[];for(var r=Math.max(4,Math.ceil(.4*t)),a=Math.min(r,y.numbers.length);n.length<a;)n=n.concat(B([...y.numbers]).slice(0,a-n.length));var l=t-n.length;for(let e=0;e<l;e++)n.push(Math.floor(Math.random()*G())+1);n=B(n);for(let e=0;e<t;e++){var o=n[e];b.push(o);let r=document.createElement("div");r.className="tower-cell",r.textContent=o,r.dataset.number=o,r.addEventListener("click",()=>{var e,t,n;e=r,v&&(t=parseInt(e.dataset.number),e.classList.contains("selected")||(n=y.fn(t,p),e.classList.add("selected"),n?(e.classList.add("correct"),n=t,p=n,M++,c.textContent=M,(t=document.createElement("div")).className="tower-block",t.textContent=n,m.appendChild(t),m.style.transform=`translateY(${-10*M}px)`,m.style.transition="transform 0.3s",f+=2*h,k(),n=M/w*100,u.style.width=n+"%",M>=w&&(v=!1,clearInterval(g),i.textContent=`Level Complete! +${15*h} bonus points!`,i.className="tower-feedback correct",f+=15*h,h++,k(),setTimeout(()=>{x=60,M=0,v=!0,E(),I(),L()},2e3))):(e.classList.add("wrong"),x=Math.max(5,x-3),k())))}),s.appendChild(r)}s.style.gridTemplateColumns=`repeat(${e}, 1fr)`}function B(e){var t=[...e];for(let e=t.length-1;0<e;e--){var n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function G(){return h<=2?20:h<=4?30:h<=6?50:75}function L(){clearInterval(g),g=setInterval(()=>{x--,l.textContent=`Time: ${x}s`,x<=10&&l.classList.add("time-critical"),x<=0&&(clearInterval(g),v=!1,i.textContent="Game Over! Final Score: "+f,i.className="tower-feedback wrong")},1e3)}function k(){r.textContent="Level: "+h,a.textContent="Score: "+f,l.textContent=`Time: ${x}s`}C(),e.addEventListener("click",function(){if(v){var t=Array.from(document.querySelectorAll(".tower-cell")).filter(e=>!e.classList.contains("selected")&&y.fn(parseInt(e.dataset.number),p));if(0<t.length){let e=t[Math.floor(Math.random()*t.length)];e.classList.add("hint"),setTimeout(()=>{e.classList.remove("hint")},1e3)}else i.textContent="No valid moves left!",i.className="tower-feedback info"}}),n.addEventListener("click",C),t.addEventListener("click",function(){var e;v&&0!==M&&((e=m.lastElementChild)&&m.removeChild(e),M--,c.textContent=M,(e=document.querySelector(".tower-cell.selected:last-child"))&&e.classList.remove("selected","correct","wrong"),p=0!==M&&(e=m.lastElementChild)?parseInt(e.textContent):null,m.style.transform=`translateY(${-10*M}px)`)})}export{initPuzzle};
