function initWordGame(){var e=(()=>{var e=localStorage.getItem("wordGameState");if(e)try{var t=JSON.parse(e);if(["easy","medium","hard"].includes(t.difficulty)&&"number"==typeof t.consecutiveWins&&"number"==typeof t.currentLevel)return t}catch(e){console.error("Invalid saved game state",e)}return null})();let g=e?.difficulty||"easy",u=e?.consecutiveWins||0,h=e?.currentLevel||1,f={easy:{gridCols:6,gridRows:8,minWordLength:3,maxWordLength:5,wordCount:6,timeLimit:240},medium:{gridCols:8,gridRows:10,minWordLength:4,maxWordLength:7,wordCount:8,timeLimit:300},hard:{gridCols:10,gridRows:10,minWordLength:5,maxWordLength:8,wordCount:10,timeLimit:500},maxPlacementAttempts:200,maxTotalAttempts:1e3,maxRetries:3},p=[],w=[],v=[],y=[],E=!1,C=new Set,t=0,L={horizontal:0,vertical:0,diagonal:0},r=f[g].timeLimit,S=null,U=document.getElementById("wordsearch-time")||((e=document.createElement("div")).id="wordsearch-time",e.className="word-game-timer",document.querySelector(".word-game-meta").appendChild(e),e),M=document.getElementById("wordsearch-grid"),T=document.getElementById("wordsearch-wordlist"),B=document.getElementById("wordsearch-words-left"),o=document.getElementById("wordsearch-feedback");var e=document.getElementById("wordsearch-new"),P=document.getElementById("wordsearch-hint");let n=document.getElementById("wordsearch-level"),x=document.getElementById("wordsearch-games-remaining"),l=document.querySelector("#mute-btn .material-icons"),a={select:new Audio("/audio/click.mp3"),found:new Audio("/audio/correct.mp3"),win:new Audio("/audio/win.mp3"),error:new Audio("/audio/wrong.mp3")},i=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1;function R(t){i?console.log(`Sound ${t} skipped: muted`):(console.log("Playing sound: "+t),a[t]&&(a[t].currentTime=0,a[t].play().catch(e=>console.error(`Error playing ${t} sound:`,e))))}function d(){Object.keys(a).forEach(e=>{e=e,a[e]&&(a[e].pause(),a[e].currentTime=0)})}function A(e,t,r,o){"undefined"!=typeof gtag&&gtag("event",e,{event_category:t,event_label:r,value:o})}function I(){var e=Math.floor(r/60),t=r%60;U.textContent=`Time: ${e}:`+t.toString().padStart(2,"0")}o||((o=document.createElement("div")).id="wordsearch-feedback",o.className="word-feedback",document.querySelector(".game-body").appendChild(o));var s=document.querySelector(".word-game-meta");function c(){var e={difficulty:g,consecutiveWins:u,currentLevel:h};localStorage.setItem("wordGameState",JSON.stringify(e))}async function b(){console.log("Initializing game with state:",{difficulty:g,currentLevel:h,consecutiveWins:u}),o.innerHTML=`
    <div class="loading-animation">
      <div class="loading-spinner"></div>
      <div class="loading-text">Creating your puzzle</div>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  `,o.className="word-feedback info",k("","info"),M.innerHTML="",T.innerHTML="",y=[],v=[],E=!1,C.clear(),L={horizontal:0,vertical:0,diagonal:0};var e=document.querySelector(".word-game-meta");e&&!document.getElementById("wordsearch-level")&&(e.appendChild(n),e.appendChild(x)),W();try{(w=await N(f[g])).sort((e,t)=>t.letters.length-e.letters.length),console.log("Words fetched and sorted:",w);let o=!1,n=0;for(;!o&&n<3;){n++,console.log(`Attempt ${n} to place all words`),p=Array(f[g].gridCols*f[g].gridRows).fill().map(()=>({letter:"",element:null,word:null}));let e=[],t=0,r=[...w];for(var l=f[g].wordCount,a=Math.floor(l/3),i={horizontal:a,vertical:a,diagonal:l-2*a};e.length<f[g].wordCount&&t<f.maxTotalAttempts;){var d=(r=0===r.length?[...w].filter(t=>!e.some(e=>e.word===t.word)):r)[0];O(d,i)?(e.push(d),C.add(d.word),r.shift()):(r.shift(),t++)}if((w=e).length<f[g].wordCount){console.warn(`Only placed ${w.length} out of ${f[g].wordCount} words`);var s=f[g].wordCount-w.length,c=(await N(f[g],s)).filter(e=>!C.has(e.word));let e=0;for(;w.length<f[g].wordCount&&e<f.maxTotalAttempts&&0<c.length;){var m=c[0];O(m,i)?(w.push(m),C.add(m.word),c.shift()):(c.shift(),e++)}}w.length===f[g].wordCount?o=!0:(console.warn("Failed to place all words on attempt "+n),C.clear(),(w=await N(f[g])).sort((e,t)=>t.letters.length-e.letters.length),L={horizontal:0,vertical:0,diagonal:0})}if(!o)throw new Error(`Could only place ${w.length} out of ${f[g].wordCount} words after 3 attempts`);{let r="ABCDEFGHIJKLMNOPQRSTUVWXYZ";p.forEach((e,t)=>{""===e.letter&&(e.letter=r[Math.floor(Math.random()*r.length)])})}{M.style.setProperty("--cols",f[g].gridCols),M.style.setProperty("--rows",f[g].gridRows),M.style.display="grid";let e=Math.min(window.innerWidth,600),t=e/f[g].gridCols,o=Math.min(t,50),r=o*f[g].gridCols,n=o*f[g].gridRows;M.style.width=r+"px",M.style.height=n+"px",M.style.maxWidth="100%",M.style.overflow="hidden",M.innerHTML="",p.forEach((e,t)=>{var r=document.createElement("div");r.className="wordsearch-cell",r.textContent=e.letter,r.dataset.index=t,r.style.width=o+"px",r.style.height=o+"px",r.style.fontSize=Math.min(.6*o,16)+"px",r.style.borderRadius="0",r.addEventListener("mousedown",H),r.addEventListener("mouseenter",e=>{e.preventDefault(),$(e),R("select")}),r.addEventListener("mouseup",_),r.addEventListener("touchstart",V,{passive:!1}),r.addEventListener("touchmove",Y,{passive:!1}),r.addEventListener("touchend",J),M.appendChild(r),e.element=r})}T.innerHTML="",[...w].sort((e,t)=>e.word.localeCompare(t.word)).forEach(e=>{var t=document.createElement("div");t.className="wordsearch-word",t.textContent=e.word,t.dataset.word=e.word,T.appendChild(t)}),j(),G(),W(),k(`Find ${w.length} hidden words!`,"info"),clearInterval(S),r=f[g].timeLimit,I(),S=setInterval(()=>{r--,I(),r<=0&&(clearInterval(S),k("Time's up!","error"),setTimeout(b,2e3))},1e3),t=0}catch(e){if(console.error("Game initialization failed:",e),o.innerHTML=`
    <div class="error-animation">
      <div class="error-icon">⚠️</div>
      <div class="loading-text">Setting up the board</div>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  `,o.className="word-feedback error",++t>=f.maxRetries)return o.innerHTML=`
    <div class="error-animation">
      <div class="error-icon">❌</div>
      <div>Having trouble loading</div>
      <button class="btn primary" onclick="initWordGame()">Try Again</button>
    </div>
  `,void(o.className="word-feedback error");setTimeout(()=>{var e=["FUNCTION","VARIABLE","OPERATOR","QUERY","JAVASCRIPT","REACT","ANGULAR","COMPONENT","MODULE","SCRIPT","CODING","DEBUG","ARRAY","LOOP","METHOD","CLASS","STRING","NUMBER","OBJECT","EVENT","STYLE","DESIGN","FORMAT","UPDATE","INSERT","DELETE","SELECT","TABLE","INDEX","FETCH","ROUTE","SERVER"].filter(e=>e.length>=f[g].minWordLength&&e.length<=f[g].maxWordLength),e=[...new Set(e)].filter(e=>!C.has(e));(w=D(e).slice(0,f[g].wordCount).map(e=>({word:e,letters:e.split("")}))).sort((e,t)=>t.letters.length-e.letters.length),b()},2e3)}A("word_search_started","word_search",1)}async function N(o,n=null){try{var l=Math.floor(9e5*Math.random()),e=n||o.wordCount,a=await db.collection("dictionary").where("length",">=",o.minWordLength).where("length","<=",o.maxWordLength).where("randomIndex",">=",l).orderBy("randomIndex").limit(e).get();if(a.empty)throw new Error("No words found in dictionary");let t=new Set,r=[];if(a.forEach(e=>{var e=e.data();e.word&&e.letters&&(e=e.word.toUpperCase(),C.has(e)||(t.add(e),r.push({word:e,letters:e.split("").map(e=>e.toUpperCase())})))}),0===t.size)throw new Error("No valid words found");return D(r).slice(0,n||o.wordCount)}catch(e){console.error("Error fetching words:",e);l=["FUNCTION","VARIABLE","OPERATOR","QUERY","JAVASCRIPT","REACT","ANGULAR","COMPONENT","MODULE","SCRIPT","CODING","DEBUG","ARRAY","LOOP","METHOD","CLASS","STRING","NUMBER","OBJECT","EVENT","STYLE","DESIGN","FORMAT","UPDATE","INSERT","DELETE","SELECT","TABLE","INDEX","FETCH","ROUTE","SERVER"].filter(e=>e.length>=o.minWordLength&&e.length<=o.maxWordLength);return D([...new Set(l)].filter(e=>!C.has(e))).slice(0,n||o.wordCount).map(e=>({word:e,letters:e.split("")}))}}function O(t,r){var o,e=[{id:0,type:"horizontal",rowStep:0,colStep:1},{id:1,type:"vertical",rowStep:1,colStep:0},{id:2,type:"diagonal",rowStep:1,colStep:1},{id:3,type:"diagonal",rowStep:-1,colStep:1}],n=e.filter(e=>!("horizontal"===e.type&&L.horizontal>=r.horizontal||"vertical"===e.type&&L.vertical>=r.vertical||"diagonal"===e.type&&L.diagonal>=r.diagonal));for(o of D([...0<n.length?n:e]))for(let e=0;e<50;e++){var l=0===o.rowStep?f[g].gridRows:f[g].gridRows-t.letters.length*Math.abs(o.rowStep),a=0===o.colStep?f[g].gridCols:f[g].gridCols-t.letters.length*Math.abs(o.colStep),l=Math.floor(Math.random()*l),a=Math.floor(Math.random()*a);if(((e,o,n,l)=>{var a=e.letters;for(let r=0;r<a.length;r++){let e=o,t=n;switch(l){case 0:t+=r;break;case 1:e+=r;break;case 2:e+=r,t+=r;break;case 3:e-=r,t+=r}if(e<0||e>=f[g].gridRows||t<0||t>=f[g].gridCols)return;var i=e*f[g].gridCols+t;if(""!==p[i].letter&&p[i].letter!==a[r])return}return 1})(t,l,a,o.id)){h=u=m=c=s=d=i=void 0;var i=t,d=l,s=a,c=o.id,{word:m,letters:u}=i;for(let r=0;r<u.length;r++){let e=d,t=s;switch(c){case 0:t+=r;break;case 1:e+=r;break;case 2:e+=r,t+=r;break;case 3:e-=r,t+=r}var h=e*f[g].gridCols+t;p[h].letter=u[r],p[h].word=m}return"horizontal"===o.type?L.horizontal++:"vertical"===o.type?L.vertical++:"diagonal"===o.type&&L.diagonal++,1}}}function z(){if(y.length<f[g].minWordLength)R("error");else{var e=y.map(e=>p[e].letter).join(""),r=e.split("").reverse().join("");let t=e.toUpperCase(),n=r.toUpperCase(),l=w.find(e=>e.word.toUpperCase()===t||e.word.toUpperCase()===n);if(l&&!v.includes(l.word)){v.push(l.word),R("found");let r=v.length%4,o=["#7AFFC3","#8EC4FA","#FFD875","#FF9EE8"];(l.word.toUpperCase()===n?y.reverse():y).forEach((e,t)=>{t<l.letters.length&&p[e].letter===l.letters[t]&&(p[e].element.style.backgroundColor=o[r],p[e].element.classList.add("found"))});e=T.querySelector(`[data-word="${l.word}"]`);if(e&&e.remove(),G(),k("Found: "+l.word,"success"),v.length===w.length){R("win");let e=document.createElement("div"),t=(e.className="victory-screen",F(),u++,h++,""),r=!1,o=(3<=u?(t="easy"===g?(g="medium",r=!0,"🎉 Advanced to Medium level! 🎉"):"medium"===g?(g="hard",r=!0,"🏆 Advanced to Hard level! 🏆"):"👑 Mastered Hard level! Continuing at max difficulty. 👑",r&&(u=0,setTimeout(()=>F({particleCount:200,spread:100}),1e3))):t=`🎊 Level ${h} Complete! 🎊`,e.innerHTML=`
      <h2>Victory!</h2>
      <p>${t}</p>
      <p>Words Found: ${v.length}</p>
      <div class="countdown">Proceeding to the next level in 5...</div>
    `,document.body.appendChild(e),5),n=e.querySelector(".countdown"),l=setInterval(()=>{o--,n.textContent=`Proceeding to the next level in ${o}...`,o<=0&&(clearInterval(l),e.remove(),c(),W(),b())},1e3);A("level_complete","word_search",g,v.length),c(),W()}}else R("error"),k("Word not found in list","error")}y=[],m()}function F(e={}){let t={particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]};confetti({...t,...e}),.5<Math.random()&&setTimeout(()=>{confetti({...t,...e,angle:180*Math.random()-90,origin:{x:Math.random(),y:.6}})},300)}function W(){var e;n&&(n.textContent=`Level: ${h} (${g})`),"hard"!==g?(e=3-u,x.textContent=0<e?"Wins to next difficulty: "+e:"Ready to advance difficulty!"):x.textContent="Max difficulty reached!"}function G(){B.textContent=`Words: ${w.length-v.length}/`+w.length}function k(e,t){o.textContent=e,o.className="word-feedback "+t}function D(e){var t=[...e];for(let e=t.length-1;0<e;e--){var r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}function H(e){e.preventDefault(),E=!0;e=q(e.target);null!==e&&(y=[e],m(),R("select"))}function $(e){var t,r,o,n,l,a;e.preventDefault(),!E||0===y.length||null===(e=q(e.target))||y.includes(e)||(t=y[y.length-1],r=f[g].gridCols,y.length<2?(l=Math.floor(t/r),o=t%r,n=Math.floor(e/r),a=e%r,Math.abs(n-l)<=1&&Math.abs(a-o)<=1&&(y.push(e),m())):(n=(()=>{if(y.length<2)return null;let e=f[g].gridCols,t=y[0],r=y[y.length-1],o=Math.floor(t/e),n=t%e,l=Math.floor(r/e),a=r%e,i=l-o,d=a-n,s=(e,t)=>t?s(t,e%t):e,c=s(Math.abs(i),Math.abs(d)),m=i/c,u=d/c;return 1<Math.abs(m)||1<Math.abs(u)?null:{row:m,col:u,type:0==m?"horizontal":0==u?"vertical":"diagonal"}})())&&(l=Math.floor(t/r),a=t%r,Math.floor(e/r)-l===n.row)&&e%r-a===n.col&&(y.push(e),m()))}function _(){E&&(E=!1,z())}function q(e){return e.classList.contains("wordsearch-cell")?parseInt(e.dataset.index):null}function m(){p.forEach(e=>{e.element.classList.remove("selected"),e.element.classList.remove("direction-locked")}),y.forEach(e=>{p[e].element.classList.add("selected")}),2<=y.length&&y.forEach(e=>{p[e].element.classList.add("direction-locked")})}function V(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("wordsearch-cell")&&H({target:e,preventDefault:()=>{}})}function Y(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("wordsearch-cell")&&$({target:e,preventDefault:()=>{}})}function J(e){e.preventDefault(),_()}function X(){var e=document.querySelector(".word-game-card");e&&(window.innerWidth<=768?(e.style.width="100%",e.style.margin="0",e.style.padding="1rem",e.style.minHeight="calc(100vh - 80px)",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center"):(e.style.width="600px",e.style.margin="2rem auto",e.style.padding="2rem",e.style.minHeight="auto",e.style.display="block")),j()}function j(){var e=T.parentElement;window.innerWidth<=768?(T.style.width="100%",T.style.maxWidth="100%",T.style.overflowX="auto",T.style.whiteSpace="nowrap",T.style.marginTop="1rem",T.style.padding="0.5rem",T.style.display="flex",T.style.flexWrap="wrap",T.style.justifyContent="center",T.querySelectorAll(".wordsearch-word").forEach(e=>{e.style.display="inline-block",e.style.margin="0.25rem 0.5rem",e.style.fontSize="14px"}),e&&(e.style.display="block",e.style.width="100%",e.style.overflow="visible")):(T.style.width="auto",T.style.maxWidth="none",T.style.overflowX="visible",T.style.whiteSpace="normal",T.style.marginTop="0",T.style.padding="0",T.style.display="grid",T.style.gridTemplateColumns="repeat(2, 1fr)",T.style.gap="0.5rem",T.querySelectorAll(".wordsearch-word").forEach(e=>{e.style.display="block",e.style.margin="0.5rem 0",e.style.fontSize="16px"}),e&&(e.style.display="block",e.style.width="auto",e.style.overflow="visible"))}s&&(s.appendChild(n),s.appendChild(x)),W(),b(),i=JSON.parse(localStorage.getItem("triviaMasterMuteState"))||!1,l&&(l.textContent=i?"volume_off":"volume_up"),i&&d(),e.addEventListener("click",b),P.addEventListener("click",function(){var e=w.filter(e=>!v.includes(e.word));0<e.length?k(`Try looking for a word starting with ${e[Math.floor(Math.random()*e.length)].word.slice(0,2)}...`,"info"):k("You found all words!","success")});s=document.getElementById("mute-btn");s&&s.addEventListener("click",()=>{i=!i,localStorage.setItem("triviaMasterMuteState",i),l&&(l.textContent=i?"volume_off":"volume_up"),i&&d()}),window.addEventListener("resize",X),X()}document.addEventListener("DOMContentLoaded",()=>{initWordGame()});export{initWordGame};
