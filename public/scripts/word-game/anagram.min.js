function initWordGame(){console.log("Initializing Anagram game");let r="",i=[],d=[],l=[],c=0,s=[],m=null,u=1,g=[{difficulty:"easy",wordLength:[6,7],games:3},{difficulty:"medium",wordLength:[8,9],games:3},{difficulty:"hard",wordLength:[10,11,12],games:3}],t=0,n=g.reduce((e,t)=>e+t.games,0),a=document.getElementById("scrambled-letters"),o=document.getElementById("current-attempt");var e=document.getElementById("anagram-submit"),h=document.getElementById("anagram-clear"),f=document.getElementById("anagram-shuffle"),E=document.getElementById("anagram-new"),w=document.getElementById("anagram-hint"),y=document.getElementById("anagram-reveal");let C=document.getElementById("anagram-feedback"),I=document.getElementById("anagram-target"),p=document.getElementById("anagram-score"),v=document.getElementById("solutions-list"),x=document.getElementById("anagram-level"),L=document.getElementById("anagram-games-remaining");function T(e){return e.split("").sort(()=>Math.random()-.5).join("")}async function M(){try{m&&(clearTimeout(m),m=null);var e=g.find(e=>u<=e.games+g.slice(0,g.indexOf(e)).reduce((e,t)=>e+t.games,0)),o=e.wordLength[Math.floor(2*Math.random())],n=Math.floor(9e5*Math.random()),a=await db.collection("dictionary").where("length","==",o).where("isCommon","==",!0).where("randomIndex",">=",n).orderBy("randomIndex").limit(50).get();let t=[];if(a.forEach(e=>{e=e.data().word.toUpperCase();s.includes(e)||t.push(e)}),0===t.length)throw new Error("No unused words found in database");r=t[Math.floor(Math.random()*t.length)],s.push(r),i=T(r).split(""),l=[],d=[],B(),N(),A(),I.textContent="Word Length: "+r.length,p.textContent="Score: "+c,x.textContent=`Level: ${u} (${e.difficulty})`,S(),C.textContent="",C.className="anagram-feedback"}catch(e){console.error("Error initializing game:",e);o=["PICTURE","SILENCE","CAPTURE","MOUNTAIN","ADVENTURE","DISCOVERY","STANDARD","PARADISE"].filter(e=>!s.includes(e));let t=g.find(e=>u<=e.games+g.slice(0,g.indexOf(e)).reduce((e,t)=>e+t.games,0)),n=t.wordLength[Math.floor(2*Math.random())],a=o.filter(e=>e.length===n);0===a.length&&(console.warn("No unused words available in fallback list. Resetting used words."),s=[],0===(a=o.filter(e=>e.length===n)).length)&&0===(a=o.filter(e=>t.wordLength.includes(e.length))).length&&(a=["PICTURE"]),r=a[Math.floor(Math.random()*a.length)],s.push(r),i=T(r).split(""),l=[],d=[],B(),N(),A(),I.textContent="Word Length: "+r.length,p.textContent="Score: "+c,x.textContent=`Level: ${u} (${t.difficulty})`,S(),C.textContent="",C.className="anagram-feedback"}}function B(){a.innerHTML="",i.forEach((e,t)=>{var n=document.createElement("div");n.className="letter-tile "+(d.includes(t)?"used":""),n.textContent=e,n.dataset.index=t,n.addEventListener("click",()=>{var e;e=t,d.includes(e)||(d.push(e),N(),B())}),a.appendChild(n)})}function N(){o.innerHTML="",d.forEach(e=>{var t=document.createElement("span");t.textContent=i[e],o.appendChild(t)})}function k(e){return 5*e.length}function b(){d=[],N(),B()}function A(){var e;v.innerHTML="",l.includes(r)&&((e=document.createElement("div")).className="solution-word",e.textContent=r,v.appendChild(e))}function R(e,t){C.textContent=t,C.className="anagram-feedback "+e}function S(){var e=g.findIndex(e=>u<=e.games+g.slice(0,g.indexOf(e)).reduce((e,t)=>e+t.games,0)),e=g.slice(0,e).reduce((e,t)=>e+t.games,0)+t,e=n-e;L.textContent="Games to Win: "+e}function $(){t++;var e=g.find(e=>u<=e.games+g.slice(0,g.indexOf(e)).reduce((e,t)=>e+t.games,0));t>=e.games&&(u++,t=0),u>n?(R("success","Congratulations! You won the game!"),setTimeout(()=>{u=1,t=0,s=[],c=0,M()},3e3)):M()}e.addEventListener("click",function(){var e;0===d.length?R("error","Please select some letters first"):(e=d.map(e=>i[e]).join("")).length!==r.length?R("error",`Word must be ${r.length} letters`):e===r?(l.push(e),c+=k(e),R("success",`Correct! You found the word! +${k(e)} points`),a.innerHTML="",A(),p.textContent="Score: "+c,b(),m&&clearTimeout(m),m=setTimeout(()=>{$(),m=null},2500)):R("error","Not the correct word")}),h.addEventListener("click",b),f.addEventListener("click",function(){i=T(r).split(""),B()}),E.addEventListener("click",M),w.addEventListener("click",function(){l.includes(r)?R("info","You already found the word!"):R("info",`Try starting with: ${r.split("").slice(0,2).join("")}...`)}),y.addEventListener("click",function(){R("info","The word was: "+r),a.innerHTML="",m&&clearTimeout(m),m=setTimeout(()=>{$(),m=null},2500)}),M()}export{initWordGame};
