function initWordGame(){var e=(()=>{var e=localStorage.getItem("wordGameState");if(e)try{var t=JSON.parse(e);if(["easy","medium","hard"].includes(t.difficulty)&&"number"==typeof t.consecutiveWins&&"number"==typeof t.currentLevel)return t}catch(e){console.error("Invalid saved game state",e)}return null})();let f=e?.difficulty||"easy",m=e?.consecutiveWins||0,u=e?.currentLevel||1,g={easy:{gridCols:6,gridRows:8,minWordLength:3,maxWordLength:5,wordCount:6,timeLimit:240},medium:{gridCols:8,gridRows:10,minWordLength:4,maxWordLength:7,wordCount:8,timeLimit:300},hard:{gridCols:10,gridRows:10,minWordLength:5,maxWordLength:8,wordCount:10,timeLimit:500},maxPlacementAttempts:200,maxTotalAttempts:1e3,maxRetries:3},w=[],p=[],y=[],v=[],o=!1,E=new Set,t=0,C={horizontal:0,vertical:0,diagonal:0},r=g[f].timeLimit,L=null,s=document.getElementById("wordsearch-time")||((e=document.createElement("div")).id="wordsearch-time",e.className="word-game-timer",document.querySelector(".word-game-meta").appendChild(e),e),M=document.getElementById("wordsearch-grid"),S=document.getElementById("wordsearch-wordlist"),c=document.getElementById("wordsearch-words-left"),n=document.getElementById("wordsearch-feedback");var e=document.getElementById("wordsearch-new"),h=document.getElementById("wordsearch-hint");let T=document.getElementById("wordsearch-level"),R=document.getElementById("wordsearch-games-remaining"),x={select:new Audio("/audio/click.mp3"),found:new Audio("/audio/correct.mp3"),win:new Audio("/audio/win.mp3"),error:new Audio("/audio/wrong.mp3")};function A(e,t,r,o){"undefined"!=typeof gtag&&gtag("event",e,{event_category:t,event_label:r,value:o})}function I(){var e=Math.floor(r/60),t=r%60;s.textContent=`Time: ${e}:`+t.toString().padStart(2,"0")}n||((n=document.createElement("div")).id="wordsearch-feedback",n.className="word-feedback",document.querySelector(".game-body").appendChild(n));var l=document.querySelector(".word-game-meta");function a(){var e={difficulty:f,consecutiveWins:m,currentLevel:u};localStorage.setItem("wordGameState",JSON.stringify(e))}async function b(){console.log("Initializing game with state:",{difficulty:f,currentLevel:u,consecutiveWins:m}),U("","info"),M.innerHTML="",S.innerHTML="",v=[],y=[],o=!1,E.clear(),C={horizontal:0,vertical:0,diagonal:0};var e=document.querySelector(".word-game-meta");e&&!document.getElementById("wordsearch-level")&&(e.appendChild(T),e.appendChild(R)),O();try{(p=await N(g[f])).sort((e,t)=>t.letters.length-e.letters.length),console.log("Words fetched and sorted:",p);let o=!1,n=0;for(;!o&&n<3;){n++,console.log(`Attempt ${n} to place all words`),w=Array(g[f].gridCols*g[f].gridRows).fill().map(()=>({letter:"",element:null,word:null}));let e=[],t=0,r=[...p];for(var l=g[f].wordCount,a=Math.floor(l/3),i={horizontal:a,vertical:a,diagonal:l-2*a};e.length<g[f].wordCount&&t<g.maxTotalAttempts;){var d=(r=0===r.length?[...p].filter(t=>!e.some(e=>e.word===t.word)):r)[0];W(d,i)?(e.push(d),E.add(d.word),r.shift()):(r.shift(),t++)}if((p=e).length<g[f].wordCount){console.warn(`Only placed ${p.length} out of ${g[f].wordCount} words`);var s=g[f].wordCount-p.length,c=(await N(g[f],s)).filter(e=>!E.has(e.word));let e=0;for(;p.length<g[f].wordCount&&e<g.maxTotalAttempts&&0<c.length;){var h=c[0];W(h,i)?(p.push(h),E.add(h.word),c.shift()):(c.shift(),e++)}}p.length===g[f].wordCount?o=!0:(console.warn("Failed to place all words on attempt "+n),E.clear(),(p=await N(g[f])).sort((e,t)=>t.letters.length-e.letters.length),C={horizontal:0,vertical:0,diagonal:0})}if(!o)throw new Error(`Could only place ${p.length} out of ${g[f].wordCount} words after 3 attempts`);{let r="ABCDEFGHIJKLMNOPQRSTUVWXYZ";w.forEach((e,t)=>{""===e.letter&&(e.letter=r[Math.floor(Math.random()*r.length)])})}{M.style.setProperty("--cols",g[f].gridCols),M.style.setProperty("--rows",g[f].gridRows),M.style.display="grid";let e=Math.min(window.innerWidth,600),t=e/g[f].gridCols,o=Math.min(t,50),r=o*g[f].gridCols,n=o*g[f].gridRows;M.style.width=r+"px",M.style.height=n+"px",M.style.maxWidth="100%",M.style.overflow="hidden",M.innerHTML="",w.forEach((e,t)=>{var r=document.createElement("div");r.className="wordsearch-cell",r.textContent=e.letter,r.dataset.index=t,r.style.width=o+"px",r.style.height=o+"px",r.style.fontSize=Math.min(.6*o,16)+"px",r.style.borderRadius="0",r.addEventListener("mousedown",F),r.addEventListener("mouseenter",e=>{e.preventDefault(),z(e),x.select.play()}),r.addEventListener("mouseup",k),r.addEventListener("touchstart",$,{passive:!1}),r.addEventListener("touchmove",H,{passive:!1}),r.addEventListener("touchend",V),M.appendChild(r),e.element=r})}S.innerHTML="",[...p].sort((e,t)=>e.word.localeCompare(t.word)).forEach(e=>{var t=document.createElement("div");t.className="wordsearch-word",t.textContent=e.word,t.dataset.word=e.word,S.appendChild(t)}),q(),D(),O(),U(`Find ${p.length} hidden words!`,"info"),clearInterval(L),r=g[f].timeLimit,I(),L=setInterval(()=>{r--,I(),r<=0&&(clearInterval(L),U("Time's up!","error"),setTimeout(b,2e3))},1e3),t=0}catch(e){if(console.error("Game initialization failed:",e),U("Failed to load puzzle. Retrying...","error"),++t>=g.maxRetries)return void U("Failed to load puzzle after multiple attempts. Please refresh the page.","error");setTimeout(()=>{var e=["FUNCTION","VARIABLE","OPERATOR","QUERY","JAVASCRIPT","REACT","ANGULAR","COMPONENT","MODULE","SCRIPT","CODING","DEBUG","ARRAY","LOOP","METHOD","CLASS","STRING","NUMBER","OBJECT","EVENT","STYLE","DESIGN","FORMAT","UPDATE","INSERT","DELETE","SELECT","TABLE","INDEX","FETCH","ROUTE","SERVER"].filter(e=>e.length>=g[f].minWordLength&&e.length<=g[f].maxWordLength),e=[...new Set(e)].filter(e=>!E.has(e));(p=B(e).slice(0,g[f].wordCount).map(e=>({word:e,letters:e.split("")}))).sort((e,t)=>t.letters.length-e.letters.length),b()},2e3)}A("word_search_started","word_search",1)}async function N(o,n=null){try{var l=Math.floor(9e5*Math.random()),e=n||o.wordCount,a=await db.collection("dictionary").where("length",">=",o.minWordLength).where("length","<=",o.maxWordLength).where("randomIndex",">=",l).orderBy("randomIndex").limit(e).get();if(a.empty)throw new Error("No words found in dictionary");let t=new Set,r=[];if(a.forEach(e=>{var e=e.data();e.word&&e.letters&&(e=e.word.toUpperCase(),E.has(e)||(t.add(e),r.push({word:e,letters:e.split("").map(e=>e.toUpperCase())})))}),0===t.size)throw new Error("No valid words found");return B(r).slice(0,n||o.wordCount)}catch(e){console.error("Error fetching words:",e);l=["FUNCTION","VARIABLE","OPERATOR","QUERY","JAVASCRIPT","REACT","ANGULAR","COMPONENT","MODULE","SCRIPT","CODING","DEBUG","ARRAY","LOOP","METHOD","CLASS","STRING","NUMBER","OBJECT","EVENT","STYLE","DESIGN","FORMAT","UPDATE","INSERT","DELETE","SELECT","TABLE","INDEX","FETCH","ROUTE","SERVER"].filter(e=>e.length>=o.minWordLength&&e.length<=o.maxWordLength);return B([...new Set(l)].filter(e=>!E.has(e))).slice(0,n||o.wordCount).map(e=>({word:e,letters:e.split("")}))}}function W(t,r){var o,e=[{id:0,type:"horizontal",rowStep:0,colStep:1},{id:1,type:"vertical",rowStep:1,colStep:0},{id:2,type:"diagonal",rowStep:1,colStep:1},{id:3,type:"diagonal",rowStep:-1,colStep:1}],n=e.filter(e=>!("horizontal"===e.type&&C.horizontal>=r.horizontal||"vertical"===e.type&&C.vertical>=r.vertical||"diagonal"===e.type&&C.diagonal>=r.diagonal));for(o of B([...0<n.length?n:e]))for(let e=0;e<50;e++){var l=0===o.rowStep?g[f].gridRows:g[f].gridRows-t.letters.length*Math.abs(o.rowStep),a=0===o.colStep?g[f].gridCols:g[f].gridCols-t.letters.length*Math.abs(o.colStep),l=Math.floor(Math.random()*l),a=Math.floor(Math.random()*a);if(((e,o,n,l)=>{var a=e.letters;for(let r=0;r<a.length;r++){let e=o,t=n;switch(l){case 0:t+=r;break;case 1:e+=r;break;case 2:e+=r,t+=r;break;case 3:e-=r,t+=r}if(e<0||e>=g[f].gridRows||t<0||t>=g[f].gridCols)return;var i=e*g[f].gridCols+t;if(""!==w[i].letter&&w[i].letter!==a[r])return}return 1})(t,l,a,o.id)){u=m=h=c=s=d=i=void 0;var i=t,d=l,s=a,c=o.id,{word:h,letters:m}=i;for(let r=0;r<m.length;r++){let e=d,t=s;switch(c){case 0:t+=r;break;case 1:e+=r;break;case 2:e+=r,t+=r;break;case 3:e-=r,t+=r}var u=e*g[f].gridCols+t;w[u].letter=m[r],w[u].word=h}return"horizontal"===o.type?C.horizontal++:"vertical"===o.type?C.vertical++:"diagonal"===o.type&&C.diagonal++,1}}}function P(){if(v.length<g[f].minWordLength)x.error.play();else{var e=v.map(e=>w[e].letter).join(""),r=e.split("").reverse().join("");let t=e.toUpperCase(),n=r.toUpperCase(),l=p.find(e=>e.word.toUpperCase()===t||e.word.toUpperCase()===n);if(l&&!y.includes(l.word)){y.push(l.word),x.found.play();let r=y.length%4,o=["#7AFFC3","#8EC4FA","#FFD875","#FF9EE8"];(l.word.toUpperCase()===n?v.reverse():v).forEach((e,t)=>{t<l.letters.length&&w[e].letter===l.letters[t]&&(w[e].element.style.backgroundColor=o[r],w[e].element.classList.add("found"))});e=S.querySelector(`[data-word="${l.word}"]`);if(e&&e.remove(),D(),U("Found: "+l.word,"success"),y.length===p.length){x.win.play();let e=document.createElement("div"),t=(e.className="victory-screen",i(),m++,u++,""),r=!1,o=(3<=m?(t="easy"===f?(f="medium",r=!0,"🎉 Advanced to Medium level! 🎉"):"medium"===f?(f="hard",r=!0,"🏆 Advanced to Hard level! 🏆"):"👑 Mastered Hard level! Continuing at max difficulty. 👑",r&&(m=0,setTimeout(()=>i({particleCount:200,spread:100}),1e3))):t=`🎊 Level ${u} Complete! 🎊`,e.innerHTML=`
      <h2>Victory!</h2>
      <p>${t}</p>
      <p>Words Found: ${y.length}</p>
      <div class="countdown">Proceeding to the next level in 5...</div>
    `,document.body.appendChild(e),5),n=e.querySelector(".countdown"),l=setInterval(()=>{o--,n.textContent=`Proceeding to the next level in ${o}...`,o<=0&&(clearInterval(l),e.remove(),a(),O(),b())},1e3);A("level_complete","word_search",f,y.length),a(),O()}}else x.error.play(),U("Word not found in list","error")}v=[],d()}function i(e={}){let t={particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]};confetti({...t,...e}),.5<Math.random()&&setTimeout(()=>{confetti({...t,...e,angle:180*Math.random()-90,origin:{x:Math.random(),y:.6}})},300)}function O(){var e;T&&(T.textContent=`Level: ${u} (${f})`),"hard"!==f?(e=3-m,R.textContent=0<e?"Wins to next difficulty: "+e:"Ready to advance difficulty!"):R.textContent="Max difficulty reached!"}function D(){c.textContent=`Words: ${p.length-y.length}/`+p.length}function U(e,t){n.textContent=e,n.className="word-feedback "+t}function B(e){var t=[...e];for(let e=t.length-1;0<e;e--){var r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}function F(e){e.preventDefault(),o=!0;e=G(e.target);null!==e&&(v=[e],d(),x.select.play())}function z(e){var t,r;e.preventDefault(),!o||0===v.length||null===(e=G(e.target))||v.includes(e)||(t=v[v.length-1],r=(()=>{if(!(v.length<2)){var e=v[0],t=v[1],r=g[f].gridCols,o=Math.floor(e/r),e=e%r,o=Math.floor(t/r)-o,t=t%r-e;if(0==o&&0!=t)return{row:0,col:Math.sign(t)};if(0==t&&0!=o)return{row:Math.sign(o),col:0};if(Math.abs(o)===Math.abs(t))return{row:Math.sign(o),col:Math.sign(t)}}return null})(),1<v.length&&!((e,t,r)=>{var o,n,l;return!r||(n=g[f].gridCols,o=Math.floor(e/n),e%=n,l=Math.floor(t/n),t%=n,n=l-o,l=t-e,v.length<2?Math.abs(n)<=1&&Math.abs(l)<=1:0===r.row?0==n&&1===Math.abs(l):0===r.col?0==l&&1===Math.abs(n):(o=Math.sign(n),t=Math.sign(l),o===r.row&&t===r.col&&Math.abs(n)<=1&&Math.abs(l)<=1))})(t,e,r))||(v.push(e),d())}function k(){o&&(o=!1,P())}function G(e){return e.classList.contains("wordsearch-cell")?parseInt(e.dataset.index):null}function d(){w.forEach(e=>{e.element.classList.remove("selected")}),v.forEach(e=>{w[e].element.classList.add("selected")})}function $(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("wordsearch-cell")&&F({target:e,preventDefault:()=>{}})}function H(e){e.preventDefault();e=e.touches[0],e=document.elementFromPoint(e.clientX,e.clientY);e&&e.classList.contains("wordsearch-cell")&&z({target:e,preventDefault:()=>{}})}function V(e){e.preventDefault(),k()}function Y(){var e=document.querySelector(".word-game-card");e&&(window.innerWidth<=768?(e.style.width="100%",e.style.margin="0",e.style.padding="1rem",e.style.minHeight="calc(100vh - 80px)",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center"):(e.style.width="600px",e.style.margin="2rem auto",e.style.padding="2rem",e.style.minHeight="auto",e.style.display="block")),q()}function q(){var e=S.parentElement;window.innerWidth<=768?(S.style.width="100%",S.style.maxWidth="100%",S.style.overflowX="auto",S.style.whiteSpace="nowrap",S.style.marginTop="1rem",S.style.padding="0.5rem",S.style.display="flex",S.style.flexWrap="wrap",S.style.justifyContent="center",S.querySelectorAll(".wordsearch-word").forEach(e=>{e.style.display="inline-block",e.style.margin="0.25rem 0.5rem",e.style.fontSize="14px"}),e&&(e.style.display="block",e.style.width="100%",e.style.overflow="visible")):(S.style.width="auto",S.style.maxWidth="none",S.style.overflowX="visible",S.style.whiteSpace="normal",S.style.marginTop="0",S.style.padding="0",S.style.display="grid",S.style.gridTemplateColumns="repeat(2, 1fr)",S.style.gap="0.5rem",S.querySelectorAll(".wordsearch-word").forEach(e=>{e.style.display="block",e.style.margin="0.5rem 0",e.style.fontSize="16px"}),e&&(e.style.display="block",e.style.width="auto",e.style.overflow="visible"))}l&&(l.appendChild(T),l.appendChild(R)),O(),b(),e.addEventListener("click",b),h.addEventListener("click",function(){var e=p.filter(e=>!y.includes(e.word));0<e.length?U(`Try looking for a word starting with ${e[Math.floor(Math.random()*e.length)].word.slice(0,2)}...`,"info"):U("You found all words!","success")}),window.addEventListener("resize",Y),Y()}document.addEventListener("DOMContentLoaded",()=>{initWordGame()});export{initWordGame};
