function initPuzzle(){console.log("Initializing Enhanced Number Scramble game");let gameState={numbers:[],target:0,score:0,currentExpression:"",usedNumbers:[],usedIndices:[],streak:0,bestStreak:0,level:1,xp:0,coins:0,difficulty:"easy",gamesPlayed:{easy:0,medium:0,hard:0},consecutiveHardWins:0,unlockedFeatures:["basic"],challengeMode:null,stats:{puzzlesSolved:0,totalPoints:0,hintsUsed:0,perfectSolutions:0}},elements={tilesContainer:document.getElementById("scramble-tiles"),operatorsContainer:document.getElementById("scramble-operators"),submitBtn:document.getElementById("scramble-submit"),clearBtn:document.getElementById("scramble-clear"),newBtn:document.getElementById("scramble-new"),hintBtn:document.getElementById("scramble-hint"),feedbackEl:document.getElementById("scramble-feedback"),targetEl:document.getElementById("scramble-target"),scoreEl:document.getElementById("scramble-score"),levelEl:document.getElementById("scramble-level"),streakEl:document.getElementById("scramble-streak"),progressEl:document.getElementById("scramble-progress"),xpBar:document.getElementById("scramble-xp-bar"),coinsEl:document.getElementById("scramble-coins")};function trackEvent(e,t,a,n){"undefined"!=typeof gtag&&gtag("event",e,{event_category:t,event_label:a,value:n})}function clearInput(){gameState.currentExpression="",gameState.usedNumbers=[],renderTiles(),updateFeedback("info","Cleared")}function initGame(){setupEventListeners(),generateNewPuzzle(),updateUI()}function generateNewPuzzle(){trackEvent("scramble_started","number_scramble",1),gameState.currentExpression="",gameState.usedNumbers=[],gameState.numbers=generateNumbers(),gameState.target=generateTarget(),renderTiles(),renderOperators(),updateUI(),flashTarget()}function flashTarget(){let e=elements.targetEl;e.style.transition="all 0.3s",e.style.transform="scale(1.2)",e.style.color="#ffd700",setTimeout(()=>{e.style.transform="scale(1)",e.style.color=""},500)}function generateNumbers(){var t=6+Math.floor(gameState.level/5),a=[];for(let e=0;e<t;e++){let e=9;"medium"===gameState.difficulty&&(e=15),"hard"===gameState.difficulty&&(e=25),"expert"===gameState.difficulty&&(e=50),a.push(Math.floor(Math.random()*e)+1)}return a}function generateTarget(){let e=10,t=100;return"medium"===gameState.difficulty?(e=50,t=200):"hard"===gameState.difficulty?(e=100,t=500):"expert"===gameState.difficulty&&(e=200,t=1e3),Math.floor(Math.random()*(t-e+1))+e}function updateDifficulty(){gameState.gamesPlayed.easy<5?gameState.difficulty="easy":gameState.gamesPlayed.medium<5?gameState.difficulty="medium":gameState.difficulty="hard"}function renderTiles(){elements.tilesContainer.innerHTML="",gameState.numbers.forEach((e,t)=>{var a=document.createElement("div");a.className="scramble-tile "+(gameState.usedNumbers.includes(t)?"used":""),a.textContent=e,a.dataset.index=t,a.addEventListener("click",()=>selectNumber(t)),elements.tilesContainer.appendChild(a)})}function renderOperators(){elements.operatorsContainer.innerHTML="";["+","-","*","/"].forEach(e=>{var t=document.createElement("button");t.className="btn small",t.textContent=e,t.addEventListener("click",()=>addOperator(e)),elements.operatorsContainer.appendChild(t)})}function selectNumber(e){gameState.currentExpression+=gameState.numbers[e],renderTiles(),updateFeedback("info","Current: "+gameState.currentExpression)}function addOperator(e){gameState.currentExpression+=e,gameState.usedNumbers=[],renderTiles(),updateFeedback("info","Current: "+gameState.currentExpression)}function submitSolution(){if(gameState.currentExpression&&gameState.currentExpression!==gameState.target.toString())if(/[\+\-\*\/]/.test(gameState.currentExpression))try{let result=eval(gameState.currentExpression);Math.abs(result-gameState.target)<1e-4?handleCorrectSolution():handleIncorrectSolution(result)}catch(error){updateFeedback("error","Invalid mathematical expression")}else updateFeedback("error","Use at least one operator (+, -, *, /)");else updateFeedback("error","Create an expression using the numbers!")}function handleCorrectSolution(){let e=10;if(gameState.streak++,gameState.streak>gameState.bestStreak&&(gameState.bestStreak=gameState.streak),"medium"===gameState.difficulty&&(e*=1.5),"hard"===gameState.difficulty&&(e*=2),"expert"===gameState.difficulty&&(e*=3),5<=gameState.streak&&(e*=1.5),10<=gameState.streak&&(e*=2),e=Math.round(e)||0,gameState.score+=e,gameState.stats.puzzlesSolved++,gameState.stats.totalPoints+=e,gameState.gamesPlayed[gameState.difficulty]++,"hard"===gameState.difficulty){if(gameState.consecutiveHardWins++,5<=gameState.consecutiveHardWins)return endGame(),void trackEvent("scramble_end","number_scramble",1)}else gameState.consecutiveHardWins=0;addXP(e),addCoins(Math.floor(e/2)),updateDifficulty(),updateFeedback("success",`Correct! ${gameState.currentExpression} = ${gameState.target} (+${e} points)`),updateUI(),setTimeout(()=>{elements.feedbackEl.textContent="",elements.feedbackEl.className="scramble-feedback",generateNewPuzzle()},1500)}function handleIncorrectSolution(e){updateFeedback("error",`Incorrect! ${gameState.currentExpression} = ${e} (Target: ${gameState.target})`),resetStreak(),"hard"===gameState.difficulty&&(gameState.consecutiveHardWins=0)}function resetStreak(){gameState.streak=0,updateUI()}function endGame(){updateFeedback("success","Congratulations! You won the game with 5 consecutive hard-level victories!"),elements.submitBtn.disabled=!0,elements.clearBtn.disabled=!0,elements.newBtn.disabled=!0,elements.hintBtn.disabled=!0,elements.tilesContainer.innerHTML="",elements.operatorsContainer.innerHTML="",elements.progressEl&&(elements.progressEl.textContent="")}function addXP(e){gameState.xp+=e;e=100*gameState.level;gameState.xp>=e&&(gameState.level++,gameState.xp=gameState.xp-e,showRewardNotification("Level Up! Now level "+gameState.level,100)),updateUI()}function addCoins(e){gameState.coins+=e,0<e&&showRewardNotification(`+${e} Coins`,e),updateUI()}function showRewardNotification(e,t){let a=document.createElement("div");a.className="reward-notification",a.innerHTML=`
            <div>${e}</div>
            ${t?`<div class="reward-amount">+${t}</div>`:""}
        `,document.body.appendChild(a),setTimeout(()=>{a.classList.add("show")},10),setTimeout(()=>{a.classList.remove("show"),setTimeout(()=>{a.remove()},300)},3e3)}function updateFeedback(e,t){elements.feedbackEl.textContent=t,elements.feedbackEl.className="scramble-feedback "+e}function updateUI(){var e;elements.targetEl.innerHTML=`
            Target: <span class="difficulty-${gameState.difficulty}"><b>${gameState.target}</b></span>
            <span class="difficulty-${gameState.difficulty}">(${gameState.difficulty})</span>
        `,elements.scoreEl.textContent="Score: "+gameState.score,elements.streakEl&&(elements.streakEl.innerHTML=0<gameState.streak?`Streak: ${gameState.streak} <span class="streak-fire">ðŸ”¥</span>`:""),elements.levelEl&&(elements.levelEl.textContent="Level: "+gameState.level),elements.xpBar&&(e=100*gameState.level,e=gameState.xp/e*100,elements.xpBar.style.width=e+"%"),elements.coinsEl&&(elements.coinsEl.textContent="Coins: "+gameState.coins),elements.progressEl&&("easy"===gameState.difficulty?(e=5-gameState.gamesPlayed.easy,elements.progressEl.textContent=e+` more game${1==e?"":"s"} to Medium`):"medium"===gameState.difficulty?(e=5-gameState.gamesPlayed.medium,elements.progressEl.textContent=e+` more game${1==e?"":"s"} to Hard`):"hard"===gameState.difficulty&&(e=5-gameState.consecutiveHardWins,elements.progressEl.textContent=e+` more consecutive win${1==e?"":"s"} to win the game`))}function setupEventListeners(){elements.submitBtn.addEventListener("click",submitSolution),elements.clearBtn.addEventListener("click",clearInput),elements.newBtn.addEventListener("click",generateNewPuzzle),elements.hintBtn.addEventListener("click",showHint)}function showHint(){gameState.stats.hintsUsed++,0<gameState.numbers.length&&updateFeedback("hint","Try starting with "+gameState.numbers[0])}initGame()}export{initPuzzle};
